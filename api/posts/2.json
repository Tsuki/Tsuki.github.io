{"total":54,"pageSize":10,"pageCount":6,"data":[{"_id":"cjmal22370000tpnyeodvqbc1","title":"SQL語法中的過濾方法","slug":"SQL語法中的過濾方法","date":"2018-09-20T20:17:49.000Z","updated":"2018-09-20T12:58:44.135Z","comments":true,"permalink":"/2018/09/20/SQL語法中的過濾方法/","path":"api/articles/SQL語法中的過濾方法.json","excerpt":"","keywords":null,"cover":null,"content":"<p>在統計系統中，很常用到不同維度的分類和過澽，</p>\n<p>比如按類加總/平均等等</p>\n<table>\n<thead>\n<tr>\n<th>Id</th>\n<th>Gender</th>\n<th>Salary</th>\n<th>Country</th>\n<th>Position</th>\n<th>Status</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>M</td>\n<td>1000</td>\n<td>China</td>\n<td>Software</td>\n<td>working</td>\n</tr>\n<tr>\n<td>2</td>\n<td>F</td>\n<td>2000</td>\n<td>USA</td>\n<td>Software</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>3</td>\n<td>M</td>\n<td>5000</td>\n<td>UK</td>\n<td>Hardware</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>4</td>\n<td>F</td>\n<td>4000</td>\n<td>Germany</td>\n<td>Hardware</td>\n<td>working</td>\n</tr>\n<tr>\n<td>5</td>\n<td>M</td>\n<td>5000</td>\n<td>USA</td>\n<td>Admin</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>6</td>\n<td>F</td>\n<td>4000</td>\n<td>Germany</td>\n<td>Admin</td>\n<td>holiday</td>\n</tr>\n</tbody>\n</table>\n<p>如果在上要一次過找出Admin和非Admin人員的平均Salary可以在 SQL中用 filter 或 case</p>\n<p>PostgreSQL</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(salary) filter (<span class=\"keyword\">where</span> <span class=\"keyword\">position</span> = <span class=\"string\">'admin'</span>)  <span class=\"keyword\">as</span> admin_avg_salary,</span><br><span class=\"line\">       <span class=\"keyword\">avg</span>(salary) filter (<span class=\"keyword\">where</span> <span class=\"keyword\">position</span> &lt;&gt; <span class=\"string\">'admin'</span>) <span class=\"keyword\">as</span> non_admin_avg_salary</span><br><span class=\"line\"><span class=\"keyword\">from</span> raw_data</span><br></pre></td></tr></table></figure>\n<p>MySQL</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(salary <span class=\"keyword\">CASE</span></span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> <span class=\"keyword\">position</span> = <span class=\"string\">'admin'</span> <span class=\"keyword\">THEN</span> salary</span><br><span class=\"line\">                    <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> <span class=\"keyword\">END</span>) <span class=\"keyword\">as</span> admin_avg_salary,</span><br><span class=\"line\">       <span class=\"keyword\">avg</span>(salary <span class=\"keyword\">CASE</span></span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> <span class=\"keyword\">position</span> &lt;&gt; <span class=\"string\">'admin'</span> <span class=\"keyword\">THEN</span> salary</span><br><span class=\"line\">                    <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> <span class=\"keyword\">END</span>) <span class=\"keyword\">as</span> non_admin_avg_salary</span><br><span class=\"line\"><span class=\"keyword\">from</span> raw_data</span><br></pre></td></tr></table></figure>\n","text":"在統計系統中，很常用到不同維度的分類和過澽，比如按類加總/平均等等IdGenderSalaryCountryPositionStatus1M1000ChinaSoftwareworking2F2000USASoftwareholiday3M5000UKHardwareholida","link":"","raw":null,"photos":["/2018/09/20/SQL語法中的過濾方法/121654695498494.jpg"],"source":"_posts/2018/09/20-SQL語法中的過濾方法.md","categories":[{"name":"SQL","slug":"SQL","count":2,"path":"api/categories/SQL.json"}],"tags":[]},{"_id":"cjlenu7du0000u5ms981wunyh","title":"gorm兼容net.IP類","slug":"gorm兼容net-IP類","date":"2018-08-29T12:04:38.000Z","updated":"2018-08-29T06:37:22.933Z","comments":true,"permalink":"/2018/08/29/gorm兼容net-IP類/","path":"api/articles/gorm兼容net-IP類.json","excerpt":"","keywords":null,"cover":null,"content":"<p>首先 alias net.IP類到本地包，為之後實作方法。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> IP net.IP</span><br></pre></td></tr></table></figure>\n<p>因為pg不能直接使用<code>[]byte</code>作為輸入，所以需要實作<code>Value()</code>令Gorm 能轉換成字串作為輸入。</p>\n<p>先從自定義的 <code>IP</code> 類轉換回 <code>net.IP</code> 類，再用 <code>String()</code> 轉成字串。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a IP)</span> <span class=\"title\">Value</span><span class=\"params\">()</span> <span class=\"params\">(driver.Value, error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> net.IP(a).String(), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 別外，由於從pg 內讀取出來的是 <code>[]unit8</code> 類，內部數據是 ASIIC 碼，所以先轉換成 byte合併成 Array 再轉成 string.</p>\n<p> 最後用 net 庫內的 ParseIP 方法 轉成 IP 類，之後再 cast 成自定義的 IP 類 返回。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> IP net.IP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *IP)</span> <span class=\"title\">Scan</span><span class=\"params\">(src <span class=\"keyword\">interface</span>&#123;&#125;)</span> <span class=\"title\">error</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> x := src.(<span class=\"keyword\">type</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> []<span class=\"keyword\">uint8</span>:</span><br><span class=\"line\">\t\t*a = IP(net.ParseIP(<span class=\"keyword\">string</span>(x)))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"literal\">nil</span>:</span><br><span class=\"line\">\t\t*a = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">\"pq: cannot convert %T to net.IP\"</span>, src)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a IP)</span> <span class=\"title\">Value</span><span class=\"params\">()</span> <span class=\"params\">(driver.Value, error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> net.IP(a).String(), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","text":"首先 alias net.IP類到本地包，為之後實作方法。<br>type IP net.IP<br>因為pg不能直接使用[]byte作為輸入，所以需要實作Value()令Gorm 能轉換成字串作為輸入。先從自定義的 IP 類轉換回 net.IP 類，再用 String() 轉成","link":"","raw":null,"photos":["/2018/08/29/gorm兼容net-IP類/photo_2018-08-29_12-08-58.jpg"],"source":"_posts/2018/08/29-gorm兼容net-IP類.md","categories":[{"name":"Golang","slug":"Golang","count":3,"path":"api/categories/Golang.json"}],"tags":[]},{"_id":"cjlcicwtm0000u0mppnj5f5mq","title":"Diablo2打寶","slug":"Diablo2打寶","date":"2018-08-28T00:11:54.000Z","updated":"2018-08-27T16:39:02.018Z","comments":true,"permalink":"/2018/08/28/Diablo2打寶/","path":"api/articles/Diablo2打寶.json","excerpt":"","keywords":null,"cover":null,"content":"<h3 id=\"刷刷刷\"><a href=\"#刷刷刷\" class=\"headerlink\" title=\"刷刷刷\"></a>刷刷刷</h3><p>在飛了三天槌子後，今天（27號），終於打了喬丹之石，而且還是連出兩粒。第二粒在最後一把出的，別外還刷到接近頂值的馬拉的萬花筒（19抗性），實在太令人高興了。</p>\n<p>這兩天把裝備提升，先刷到撒卡蘭姆使者，再刷到橡樹之心符文，在崔凡特己經可以穩定刷下去，但秘密母牛關還是有點壓力，而且刷起來不太效率。</p>\n<p>在刷了好喬丹後，之後的喬丹之石就可以拿來開地表暗黑破壞神，玩了這麼多年還沒打過這隻呢。</p>\n<p>之後去刷無限符文好還是謎團符文好呢？</p>\n","text":"刷刷刷在飛了三天槌子後，今天（27號），終於打了喬丹之石，而且還是連出兩粒。第二粒在最後一把出的，別外還刷到接近頂值的馬拉的萬花筒（19抗性），實在太令人高興了。這兩天把裝備提升，先刷到撒卡蘭姆使者，再刷到橡樹之心符文，在崔凡特己經可以穩定刷下去，但秘密母牛關還是有點壓力，而且刷","link":"","raw":null,"photos":["/2018/08/28/Diablo2打寶/cjkewc6ah017y8i5nkovypyyw.1200.jpg"],"source":"_posts/2018/08/28-Diablo2打寶.md","categories":[{"name":"遊戲","slug":"遊戲","count":2,"path":"api/categories/遊戲.json"}],"tags":[]},{"_id":"cjl7zuctz0000tvuhawty753q","title":"暗黑破壞神","slug":"Diablo2","date":"2018-08-24T20:18:10.000Z","updated":"2018-08-24T12:51:55.780Z","comments":true,"permalink":"/2018/08/24/Diablo2/","path":"api/articles/Diablo2.json","excerpt":"","keywords":null,"cover":null,"content":"<h4 id=\"暗黑破壞神-2\"><a href=\"#暗黑破壞神-2\" class=\"headerlink\" title=\"暗黑破壞神 2\"></a>暗黑破壞神 2</h4><p>這個快二十多年的遊戲，想到不今時今日還有不少人在玩，在YouTube 上還有不少人上傳/直播打寶。現在官服還在維護，今天六月時天梯還有重置，而且還有不少玩家在線。</p>\n<h4 id=\"私服\"><a href=\"#私服\" class=\"headerlink\" title=\"私服\"></a>私服</h4><p>現在D2除了正服外，還有不少私服，這些私服各有特色，有些是和正服一樣，有些是PVP服，還有倍率服。對於沒有時間或想重投D2的懷舊玩家來說，是不錯的選擇。</p>\n<h4 id=\"角色\"><a href=\"#角色\" class=\"headerlink\" title=\"角色\"></a>角色</h4><p>當年第一個玩的角色，沒記錯應該是死靈法師，那時覺得帶著一大隊小弟，在單人模式上會輕鬆。現實上死靈法師在地獄難度之前，難易度是滿低的。</p>\n<p>其次玩的是法師吧，法師的傳送是D2打寶的關建，除非有迷團甲。但迷團是相當高級的符文組，當年我連眼光都沒合成過，更別說迷團，那時拿的只是双精神，而且得用塔盾的精神。</p>\n<p>現在重玩一下私服，就先練了個祝槌聖騎。雖然不算最好用的角式，但是是最易上手和最安全的角色。</p>\n<h4 id=\"最後\"><a href=\"#最後\" class=\"headerlink\" title=\"最後\"></a>最後</h4><p>不小心把黑吉德賣了啊！！！！好想要SOJ啊！！！我還沒打過地表和三王啊！！！！！</p>\n","text":"暗黑破壞神 2這個快二十多年的遊戲，想到不今時今日還有不少人在玩，在YouTube 上還有不少人上傳/直播打寶。現在官服還在維護，今天六月時天梯還有重置，而且還有不少玩家在線。私服現在D2除了正服外，還有不少私服，這些私服各有特色，有些是和正服一樣，有些是PVP服，還有倍率服。對","link":"","raw":null,"photos":["/2018/08/24/Diablo2/cjkewokd0018k8i5nmjbn075f.1200.jpg"],"source":"_posts/2018/08/24-Diablo2.md","categories":[{"name":"遊戲","slug":"遊戲","count":2,"path":"api/categories/遊戲.json"}],"tags":[]},{"_id":"cjl297e6e0000u4noni3wptzk","title":"Docker清理","slug":"Docker清理","date":"2018-08-20T20:01:56.000Z","updated":"2018-08-20T12:25:09.461Z","comments":true,"permalink":"/2018/08/20/Docker清理/","path":"api/articles/Docker清理.json","excerpt":"","keywords":null,"cover":null,"content":"<h3 id=\"查看已使用空間\"><a href=\"#查看已使用空間\" class=\"headerlink\" title=\"查看已使用空間\"></a>查看已使用空間</h3><blockquote>\n<p>docker system df</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE</span><br><span class=\"line\">Images              17                  15                  5.531GB             1.822GB (32%)</span><br><span class=\"line\">Containers          20                  1                   251.6MB             212.2MB (84%)</span><br><span class=\"line\">Local Volumes       42                  17                  1.09GB              174.5MB (16%)</span><br><span class=\"line\">Build Cache         0                   0                   0B                  0B</span><br></pre></td></tr></table></figure>\n<h3 id=\"清理空間\"><a href=\"#清理空間\" class=\"headerlink\" title=\"清理空間\"></a>清理空間</h3><p>Remove local volumes not used by at least one container - 沒有在使用的空間</p>\n<blockquote>\n<p>docker volume prune</p>\n</blockquote>\n<h3 id=\"清理容器\"><a href=\"#清理容器\" class=\"headerlink\" title=\"清理容器\"></a>清理容器</h3><p>Remove all stopped containers - 己停用的容器</p>\n<blockquote>\n<p>docker container prune</p>\n</blockquote>\n<h3 id=\"清理影像\"><a href=\"#清理影像\" class=\"headerlink\" title=\"清理影像\"></a>清理影像</h3><p>Remove dangling images - 沒有被tag的影像層</p>\n<blockquote>\n<p>docker image prune</p>\n</blockquote>\n<p>Remove images without at least one container associated - 沒有在使用的影像</p>\n<blockquote>\n<p>docker image prune -a</p>\n</blockquote>\n<h3 id=\"全面清理\"><a href=\"#全面清理\" class=\"headerlink\" title=\"全面清理\"></a>全面清理</h3><ul>\n<li>Remove stopped containers - 己停用的容器</li>\n<li>Remove networks not used by at least one container - 沒有容器連接的網絡</li>\n<li>Remove dangling images - 沒有被tag</li>\n<li>Remove build cache - 構建快取</li>\n</ul>\n<blockquote>\n<p>docker system prune</p>\n</blockquote>\n","text":"查看已使用空間docker system df<br><br><br><br><br>TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE<br>Im","link":"","raw":null,"photos":["/2018/08/20/Docker清理/3GtH1bB.jpg"],"source":"_posts/2018/08/20-Docker清理.md","categories":[{"name":"Ops","slug":"Ops","count":6,"path":"api/categories/Ops.json"}],"tags":[]},{"_id":"cjkzfmclx0000tup6bj9dxnqa","title":"不如意事十常八九","slug":"不如意事十常八九","date":"2018-08-18T11:29:01.000Z","updated":"2018-08-18T13:01:30.769Z","comments":true,"permalink":"/2018/08/18/不如意事十常八九/","path":"api/articles/不如意事十常八九.json","excerpt":"","keywords":null,"cover":"/2018/08/18/不如意事十常八九/photo_2018-08-18_20-15-26.jpg","content":"<h4 id=\"一個人\"><a href=\"#一個人\" class=\"headerlink\" title=\"一個人\"></a>一個人</h4><p>算下來己經一個人生活了四個月了，感覺習慣嗎？並沒有。</p>\n<p>只有在其實地方生活過，才會知道以前的好。感覺生活上一直在開倒車，當經歷過低潮才懂得之前的美好。從來沒有想過以前的生活是多麽的幸褔，在新的地方，新的環境下生活並不是一件簡單的事情。</p>\n<p>這裹的治安水平並不算太高，搶手機的事情聽到不少。在這邊生活的地方基本上就是公司，宿舍兩點一線。而生活水平還算過得去，公司的伙食雖然不怎麼樣，但周邊還是有點能吃的餐館，基本上中、日、泰、韓的也有，價錢上比香港低一點但低不了不多。</p>\n<p>周邊能去的地方，基本上就周日到超市逛逛，補充一下生活用品。房間沒有電腦，以前在房間玩電腦的習慣己經成為過去。雖然買了一台任天堂 Switch，不過大多是單人遊戲為主，但玩太多的也會生厭。</p>\n<h4 id=\"醉\"><a href=\"#醉\" class=\"headerlink\" title=\"醉\"></a>醉</h4><p><img src=\"/2018/08/18/不如意事十常八九/photo_2018-08-18_20-15-26.jpg\" alt=\"\"></p>\n<p>如果醉可以忘記，可以解決，可以逃避問題，那是多麼好的事情。</p>\n<blockquote>\n<p>期盼抹去的哀愁  卻更加的愁  。</p>\n</blockquote>\n<p>可是醉了之後，只有宿醉，頭痛，胃痛等問題等著。</p>\n<blockquote>\n<p>即使昏醉  大概不想安睡 </p>\n<p>回去不回去  同樣掃不走空虛</p>\n<p>長島內苦澀太多  然後強裝甜蜜快樂</p>\n</blockquote>\n<p>以前喝的時候，都是和身邊的人互相吐嘈、互相吐苦水、互相談生活，現在喝酒更多是為了消磨時間，為醉而喝。畢竟同事不是朋友，很多說話還是不可能拿出來說。</p>\n<blockquote>\n<p>和摯友抱擁交頭  說理想追求</p>\n<p>靜靜地醉臥在門口 陪他作戰的朋友  各有各溜走</p>\n</blockquote>\n<h4 id=\"夢\"><a href=\"#夢\" class=\"headerlink\" title=\"夢\"></a>夢</h4><p><img src=\"/2018/08/18/不如意事十常八九/photo_2018-08-18_20-39-12.jpg\" alt=\"\"></p>\n<blockquote>\n<p>或者當日也曾有火種 </p>\n<p>但擔心去路其實不通 </p>\n<p>然後大計跌入四維國度失蹤</p>\n<p>就此捲入既定軌跡中 </p>\n<p>天天照例運行在虛空 </p>\n<p>像循序漸進等夠鐘 </p>\n<p>是否甘心永遠被動</p>\n</blockquote>\n<p>待續。。。</p>\n","text":"一個人算下來己經一個人生活了四個月了，感覺習慣嗎？並沒有。只有在其實地方生活過，才會知道以前的好。感覺生活上一直在開倒車，當經歷過低潮才懂得之前的美好。從來沒有想過以前的生活是多麽的幸褔，在新的地方，新的環境下生活並不是一件簡單的事情。這裹的治安水平並不算太高，搶手機的事情聽到不","link":"","raw":null,"photos":["/2018/08/18/不如意事十常八九/photo_2018-08-18_18-39-24.jpg"],"source":"_posts/2018/08/18-不如意事十常八九.md","categories":[{"name":"日記","slug":"日記","count":20,"path":"api/categories/日記.json"}],"tags":[]},{"_id":"cjkm395sw0000trnj13oraw9g","title":"Golang 偽鑽石問題","slug":"Golang-Embedding-trap","date":"2018-08-09T11:59:09.000Z","updated":"2018-12-10T11:08:42.291Z","comments":true,"permalink":"/2018/08/09/Golang-Embedding-trap/","path":"api/articles/Golang-Embedding-trap.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"Golang-偽鑽石問題\"><a href=\"#Golang-偽鑽石問題\" class=\"headerlink\" title=\"Golang 偽鑽石問題\"></a>Golang 偽鑽石問題</h1><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Reader <span class=\"keyword\">struct</span>&#123; buffer <span class=\"keyword\">int</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> Writer <span class=\"keyword\">struct</span>&#123; buffer <span class=\"keyword\">int</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ReadWriter <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tReader</span><br><span class=\"line\">\tWriter</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> rw ReadWriter</span><br><span class=\"line\">    <span class=\"comment\">// &#123;Writer:&#123;buffer:0&#125; Reader:&#123;buffer:0&#125;&#125;</span></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">\"%+v\"</span>, rw.buffer)</span><br><span class=\"line\">    <span class=\"comment\">// ambiguous selector rw.buffer</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在 go 之中沒有實現真正的繼承，<code>rw.buffer</code> 只是一個語法糖，如果內嵌結构是匿名字段會自動提升。</p>\n<p>要取得 buffer 就需要指定 <code>rw.Reader.buffer</code> 或 <code>rw.Writer.buffer</code>.</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Buffer <span class=\"keyword\">struct</span>&#123; Buffer <span class=\"keyword\">int</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">type</span> Reader <span class=\"keyword\">struct</span>&#123; Buffer &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> ReadWriter <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tBuffer</span><br><span class=\"line\">\tReader</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> rw ReadWriter</span><br><span class=\"line\">    <span class=\"comment\">// &#123;Buffer:&#123;Buffer:0&#125; Reader:&#123;Buffer:&#123;Buffer:0&#125;&#125;&#125;</span></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">\"%+v\"</span>, rw.Buffer)</span><br><span class=\"line\">    <span class=\"comment\">// &#123;int:0&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>這種寫法就沒有鑽石問題，因為淺層己經有 <code>rw.Buffer</code>，所以 <code></code>rw.Reader.buffer` 不會自動提升。</p>\n<p>不過這種寫法非常不直觀，很容易引起混亂，查看代碼時會忘了拿的是那 <code>Buffer</code>。 所以這種情況下，還是盡量避免使用。</p>\n","text":"Golang 偽鑽石問題1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>type Reader struct&#123; buffer int &#125;<br>type Wr","link":"","raw":null,"photos":["/2018/08/09/Golang-Embedding-trap/cjkewjgb8018b8i5n1doqibdi.1200.jpg"],"source":"_posts/2018/08/09-Golang-Embedding-trap.md","categories":[{"name":"Golang","slug":"Golang","count":3,"path":"api/categories/Golang.json"}],"tags":[]},{"_id":"cjkl3e31n0000tpms4oney5to","title":"DNS故障轉移測試","slug":"DNS-High-Availability","date":"2018-08-08T18:34:05.000Z","updated":"2018-12-10T11:08:42.291Z","comments":true,"permalink":"/2018/08/08/DNS-High-Availability/","path":"api/articles/DNS-High-Availability.json","excerpt":"","keywords":null,"cover":null,"content":"<p>建立 lookback 地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ifconfig lo0 <span class=\"built_in\">alias</span> 127.0.0.2 up</span><br><span class=\"line\">sudo ifconfig lo0 <span class=\"built_in\">alias</span> 127.0.0.3 up</span><br></pre></td></tr></table></figure>\n<p>在 hosts 加入本地 dns 記錄</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim /etc/hosts</span><br><span class=\"line\">127.0.0.1 localhost</span><br><span class=\"line\">127.0.0.2 localhost</span><br><span class=\"line\">127.0.0.3 localhost</span><br></pre></td></tr></table></figure>\n<p>在不同終端使用 netcat 建立本地監聽 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc -lk 127.0.0.1 8080</span><br><span class=\"line\">nc -lk 127.0.0.2 8080</span><br><span class=\"line\">nc -lk 127.0.0.3 8080</span><br></pre></td></tr></table></figure>\n<p>測試傳送信息</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nc localhost 8080</span><br></pre></td></tr></table></figure>\n<p>嘗試關閉不同終端 以測試能不能故障轉移</p>\n","text":"建立 lookback 地址1<br>2<br>sudo ifconfig lo0 alias 127.0.0.2 up<br>sudo ifconfig lo0 alias 127.0.0.3 up<br>在 hosts 加入本地 dns 記錄1<br>2<br>3<br>4<","link":"","raw":null,"photos":["/2018/08/08/DNS-High-Availability/cjkewl4ic018e8i5nkqukol2w.1200.jpg"],"source":"_posts/2018/08/08-DNS-High-Availability.md","categories":[{"name":"Ops","slug":"Ops","count":6,"path":"api/categories/Ops.json"}],"tags":[]},{"_id":"cjkhu5cs50000uftedbmpvgnz","title":"身為男高中生...讀後感","slug":"身為男高中生-讀後感","date":"2018-08-06T12:09:35.000Z","updated":"2018-08-18T13:01:30.765Z","comments":true,"permalink":"/2018/08/06/身為男高中生-讀後感/","path":"api/articles/身為男高中生-讀後感.json","excerpt":"","keywords":null,"cover":"https://blog.sukitsuki.com/2018/08/06/身為男高中生-讀後感/photo_2018-08-06_12-05-57.jpg","content":"<p>本書全名是《身為男高中生兼當紅輕小說作家的我，正被年紀比我小且從事聲優工作的女同學掐住脖子》(男子高校生で売れっ子ライトノベル作家をしているけれど、年下のクラスメイトで声優の女の子に首を絞められている。) 2014年時最長的小說作品名，一共51字呢。</p>\n<p>從書名看起來很像一本校園戀愛故事的輕小說，但現實上並，不，是。這是一本科普文，這本書一共有三集（十集，偽）。</p>\n<p>為什麼說這本書是科普文呢，因為這本說主要說的是輕小說作家出書的經歷和教學。</p>\n<p>引子是主角的小說（作中作）在休學一年期間動漫化，在复學後被身為聲優的同學發現，之後每星期在前往東京的火車上被聊的故事。本中女主角為了引起男主角的注意，因此不斷向男主角提出話題，而話題就是男主角身為作家的工作內容。</p>\n<p>第一，二集主要是在火車上互動，對話中提及大部分作家工作的內容，最後因為女主角被劇透了而掐住脖子www。看到這裹，書本己經提及大部分作家的工作內容，而且脖子也掐，應該完結吧。</p>\n<p><img src=\"https://blog.sukitsuki.com/2018/08/06/身為男高中生-讀後感/photo_2018-08-06_12-05-57.jpg\" alt=\"\"></p>\n<p>但三個月後又出了第三集，這集從本來的主角第一人稱，改為每章分拆成兩/四小章，男女主角梅花間竹的自白的敍事方式。這集一開始看上去像要回到校園生活故事，但其實還是作家的工作內容，其次是回收伏筆。</p>\n","text":"本書全名是《身為男高中生兼當紅輕小說作家的我，正被年紀比我小且從事聲優工作的女同學掐住脖子》(男子高校生で売れっ子ライトノベル作家をしているけれど、年下のクラスメイトで声優の女の子に首を絞められている。) 2014年時最長的小說作品名，一共51字呢。從書名看起來很像一本校園戀愛故","link":"","raw":null,"photos":["/2018/08/06/身為男高中生-讀後感/photo_2018-08-06_12-03-47.jpg"],"source":"_posts/2018/08/06-身為男高中生-讀後感.md","categories":[{"name":"小說","slug":"小說","count":1,"path":"api/categories/小說.json"}],"tags":[]},{"_id":"cjkdzz28z0000rjkx0u710iub","title":"從Gogs遷移到Gitea","slug":"From-gogs-to-gitea","date":"2018-08-03T18:18:01.000Z","updated":"2018-08-18T13:01:30.765Z","comments":true,"permalink":"/2018/08/03/From-gogs-to-gitea/","path":"api/articles/From-gogs-to-gitea.json","excerpt":"","keywords":null,"cover":null,"content":"<p>Gogs 其實一個升級版本引起奇怪事情，於是順便遷移到 Gitea 上，在 Gitea 官方上建意由 0.9.X 或以前升級會比較方便。</p>\n<p>但我升級到 0.11.X 以上出現問題，所在這記錄一下解決過程。</p>\n<h1 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h1><p>事源於新版 Gogs 加了/修改了 git hook 的處理方法，兼容上出現一些問題。 在推送時出現 hook declined 並被 reject.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! [remote rejected] master -&gt; master (pre-receive hook declined)</span><br></pre></td></tr></table></figure>\n<p>可能的成因是這個hook不再生效或不再兼容了</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在 /var/gogs/git/gogs-repositories/&lt;user&gt;/&lt;repo&gt;.git/hooks/pre-receiv</span></span><br><span class=\"line\"><span class=\"comment\">#找到以下內容</span></span><br><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"string\">\"/app/gogs/gogs\"</span> hook --config=<span class=\"string\">'/data/gogs/conf/app.ini'</span> pre-receive</span><br></pre></td></tr></table></figure>\n<h1 id=\"遷移\"><a href=\"#遷移\" class=\"headerlink\" title=\"遷移\"></a>遷移</h1><p>Gitea 是 Gogs 在 0.9.X 上分支，並後續開發的版本。</p>\n<h2 id=\"使用Docker-作為啟動\"><a href=\"#使用Docker-作為啟動\" class=\"headerlink\" title=\"使用Docker 作為啟動\"></a>使用Docker 作為啟動</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --name=gitea -p 10022:22 -p 10080:3000 -v /var/lib/gitea:/data gitea/gitea:latest</span><br><span class=\"line\">docker stop gitea</span><br></pre></td></tr></table></figure>\n<h2 id=\"遷移-git-倉庫和數據庫\"><a href=\"#遷移-git-倉庫和數據庫\" class=\"headerlink\" title=\"遷移 git 倉庫和數據庫\"></a>遷移 git 倉庫和數據庫</h2><p>複制倉庫到 Gitea</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp -r /var/gogs/git/gogs-repositories/* /var/lib/gitea/git/repositories/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /var/lib/gitea/gitea/conf</span><br><span class=\"line\">mv app.ini app.ini.bak</span><br><span class=\"line\">cp /var/gogs/gogs/conf/app.ini .</span><br><span class=\"line\">vim app.ini</span><br></pre></td></tr></table></figure>\n<p>複制數據庫</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE gitea WITH TEMPLATE gogs OWNER &lt;username&gt;;</span><br></pre></td></tr></table></figure>\n<p>修改 Gitea 參數</p>\n<figure class=\"highlight toml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[repository]</span></span><br><span class=\"line\"><span class=\"attr\">ROOT</span> = /data/git/repositories</span><br><span class=\"line\"><span class=\"section\">[server]</span></span><br><span class=\"line\"><span class=\"attr\">APP_DATA_PATH</span>    = /data/gitea</span><br><span class=\"line\"><span class=\"attr\">ROOT_URL</span>         = https://domain</span><br><span class=\"line\"><span class=\"attr\">DOMAIN</span>           = domain</span><br><span class=\"line\"><span class=\"section\">[database]</span></span><br><span class=\"line\"><span class=\"attr\">DB_TYPE</span>  = postgres</span><br><span class=\"line\"><span class=\"attr\">HOST</span>     = <span class=\"number\">172.17</span>.<span class=\"number\">0.1</span>:<span class=\"number\">5432</span> #docker 到外部 postgres SQL</span><br><span class=\"line\"><span class=\"attr\">NAME</span>     = gitea</span><br><span class=\"line\"><span class=\"attr\">USER</span>     = USER</span><br><span class=\"line\"><span class=\"attr\">PASSWD</span>   = PASSWD</span><br><span class=\"line\"><span class=\"attr\">SSL_MODE</span> = disable</span><br></pre></td></tr></table></figure>\n<h2 id=\"啟動並排錯\"><a href=\"#啟動並排錯\" class=\"headerlink\" title=\"啟動並排錯\"></a>啟動並排錯</h2><p>啟動 Docker </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker start gitea</span><br></pre></td></tr></table></figure>\n<p>查看 log 是否順利（通常都不順利</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">less /var/lib/gitea/gitea/<span class=\"built_in\">log</span>/gitea.log</span><br></pre></td></tr></table></figure>\n<p> 如果看到收Migration出現問題（如下</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br><span class=\"line\" data-line-number=\"19\"></span><br><span class=\"line\" data-line-number=\"20\"></span><br><span class=\"line\" data-line-number=\"21\"></span><br><span class=\"line\" data-line-number=\"22\"></span><br><span class=\"line\" data-line-number=\"23\"></span><br><span class=\"line\" data-line-number=\"24\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">17</span> [I] Migration: empty step</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">17</span> [I] Migration: empty step</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">17</span> [I] Migration: empty step</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">17</span> [I] Migration: remove index column from repo_unit table</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">17</span> [I] Migration: remove organization watch repositories</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">17</span> [I] Migration: add deleted branches</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">18</span> [I] Migration: add repo indexer status</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">18</span> [I] Migration: adds time tracking and stopwatches</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">19</span> [I] Migration: migrate protected branch <span class=\"keyword\">struct</span></span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">19</span> [I] Migration: add <span class=\"keyword\">default</span> value to user prohibit_login</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">19</span> [I] Migration: add lfs lock table</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">20</span> [I] Migration: add reactions</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">20</span> [I] Migration: add pull request options</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">20</span> [I] Migration: add writable deploy keys</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">21</span> [I] Migration: remove is_owner, num_teams columns from org_user</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">21</span> [I] Migration: add closed_unix column <span class=\"keyword\">for</span> issues</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">22</span> [I] Migration: add label descriptions</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">22</span> [I] Migration: add merge whitelist <span class=\"keyword\">for</span> protected branches</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">23</span> [I] Migration: add is_fsck_enabled column <span class=\"keyword\">for</span> repos</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">23</span> [I] Migration: add size column <span class=\"keyword\">for</span> attachments</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">24</span> [I] Migration: add last used passcode column <span class=\"keyword\">for</span> TOTP</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">24</span> [I] Migration: add language column <span class=\"keyword\">for</span> user setting</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">25</span> [I] Migration: add multiple assignees</span><br><span class=\"line\"><span class=\"number\">2018</span>/<span class=\"number\">08</span>/<span class=\"number\">03</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">26</span> [...itea/routers/init.<span class=\"keyword\">go</span>:<span class=\"number\">60</span> GlobalInit()] [E] Failed to initialize ORM engine: migrate: do migrate: pq: column <span class=\"string\">\"ref\"</span> does not exist</span><br></pre></td></tr></table></figure>\n<p>出現欄位失蹤  <code>do migrate: pq: column &quot;ref&quot; does not exist</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看 Migration 的版本</span><br><span class=\"line\">SELECT version FROM public.version t</span><br><span class=\"line\"># 顯示的是 64,</span><br></pre></td></tr></table></figure>\n<p>到 Github 上查看源碼 <a href=\"https://github.com/go-gitea/gitea/tree/master/models/migrations\" target=\"_blank\" rel=\"noopener\">https://github.com/go-gitea/gitea/tree/master/models/migrations</a></p>\n<p>找出 v64.go 並在 type Issue 或到要需要的 Ref</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE public.issue ADD ref text NULL</span><br></pre></td></tr></table></figure>\n<p>再重啟 Docker 並繼續排查問題。</p>\n<h2 id=\"清理錯誤的-Hook\"><a href=\"#清理錯誤的-Hook\" class=\"headerlink\" title=\"清理錯誤的 Hook\"></a>清理錯誤的 Hook</h2><p>再次推送時，會出現新的錯誤 </p>\n<p><code>remote: ./hooks/post-receive.d/post-receive: line 2: /app/gogs/gogs: No such file or directory</code></p>\n<p>使用以下指令清理不需要的 Gogs Hook</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/lib/gitea/git/repositories</span><br><span class=\"line\">grep -rHn gogs *|cut -d : -f1 | xargs rm</span><br></pre></td></tr></table></figure>\n<p>到這步為止，之前推送失敗的倉庫都能推送上服務器</p>\n","text":"Gogs 其實一個升級版本引起奇怪事情，於是順便遷移到 Gitea 上，在 Gitea 官方上建意由 0.9.X 或以前升級會比較方便。但我升級到 0.11.X 以上出現問題，所在這記錄一下解決過程。起因事源於新版 Gogs 加了/修改了 git hook 的處理方法，兼容上出現","link":"","raw":null,"photos":["/2018/08/03/From-gogs-to-gitea/cjkbrtbs501458i5nw9jtl9m4.jpg"],"source":"_posts/2018/08/03-From-gogs-to-gitea.md","categories":[{"name":"Ops","slug":"Ops","count":6,"path":"api/categories/Ops.json"}],"tags":[]}]}