{"total":52,"pageSize":10,"pageCount":6,"data":[{"_id":"cjpi7shya0000n8o6qswvy3ec","title":"主題遷移到 Angular 進度","slug":"主題遷移到-Angular-進度","date":"2018-12-10T16:27:32.000Z","updated":"2018-12-13T12:35:13.465Z","comments":true,"permalink":"/2018/12/10/主題遷移到-Angular-進度/","path":"api/articles/主題遷移到-Angular-進度.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"安格拉絲-Angular\"><a href=\"#安格拉絲-Angular\" class=\"headerlink\" title=\"安格拉絲 / Angular\"></a>安格拉絲 / Angular</h1><blockquote>\n<p>大紮好，我系 <a href=\"https://github.com/Tsuki/\" target=\"_blank\" rel=\"noopener\">Tsuki</a>，安格拉絲，介四里沒有挽過的船新版本，擠需體驗三番鍾，里造會幹我一樣，愛象節款框架。</p>\n</blockquote>\n<p>進度</p>\n<ul>\n<li style=\"list-style: none\"><input type=\"checkbox\" checked> Header (完成)</li>\n<li style=\"list-style: none\"><input type=\"checkbox\" checked> Pages (完成)</li>\n<li style=\"list-style: none\"><input type=\"checkbox\" checked> Article (完成)</li>\n<li style=\"list-style: none\"><input type=\"checkbox\" checked> Header 動畫  (完成)</li>\n<li style=\"list-style: none\"><input type=\"checkbox\" checked> Pages 動畫  (完成)</li>\n<li style=\"list-style: none\"><input type=\"checkbox\" checked> Footer  (完成)</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> Post page</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> Side menu</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> Article 前後頁</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> Markdown Tasklist</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> APlayer</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 優化 moment.js</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 動態注入配置</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> 評論數</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> FancyBox 效果</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> Article 置頂跑馬燈</li>\n<li style=\"list-style: none\"><input type=\"checkbox\"> Badge count</li>\n</ul>\n","text":"安格拉絲 / Angular大紮好，我系 Tsuki，安格拉絲，介四里沒有挽過的船新版本，擠需體驗三番鍾，里造會幹我一樣，愛象節款框架。進度 Header (完成) Pages (完成) Article (完成) Header 動畫  (完成) Pages 動畫  (完成) Fo","link":"","raw":null,"photos":["/2018/12/10/主題遷移到-Angular-進度/cjp8n1vtm000kwo8he3x00hiv.720p.jpg"],"source":"_posts/2018/12/10-主題遷移到-Angular-進度.md","categories":[],"tags":[]},{"_id":"cjp2c12n60000twl1iwsbrpy5","title":"如何把頁眉(Header)置頂","slug":"如何把頁眉-header-置頂","date":"2018-11-29T14:59:03.000Z","updated":"2018-11-29T08:23:17.100Z","comments":true,"permalink":"/2018/11/29/如何把頁眉-header-置頂/","path":"api/articles/如何把頁眉-header-置頂.json","excerpt":"","keywords":null,"cover":null,"content":"<h3 id=\"方案一：兼容IE\"><a href=\"#方案一：兼容IE\" class=\"headerlink\" title=\"方案一：兼容IE\"></a>方案一：兼容IE</h3><p>這個方案並不完美，position: fixed 太多坑，如果有有別一個 position: fixed 會出現奇怪的問題。</p>\n<p>現在頁面改成下面的方案二，雖然不支持IE，但減少了JS 代碼，而且css 代碼更清𥇦。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.sticky</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">5000</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sticky</span> + <span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">padding-top</span>: <span class=\"number\">92px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br><span class=\"line\" data-line-number=\"19\"></span><br><span class=\"line\" data-line-number=\"20\"></span><br><span class=\"line\" data-line-number=\"21\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">initSticky();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initSticky</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Get the header</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> header = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"header\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Get the offset position of the navbar</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> sticky = header.offsetTop;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">stickyCheck</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.pageYOffset &gt; sticky) &#123;</span><br><span class=\"line\">      header.classList.add(<span class=\"string\">\"sticky\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      header.classList.remove(<span class=\"string\">\"sticky\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.onscroll = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    stickyCheck()</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方案二：不兼容IE\"><a href=\"#方案二：不兼容IE\" class=\"headerlink\" title=\"方案二：不兼容IE\"></a>方案二：不兼容IE</h3><p>直接在本來的 header 把position: fixed改成 sticky 和 top: 0. Javascript 可以去掉</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: sticky;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">5000</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","text":"方案一：兼容IE這個方案並不完美，position: fixed 太多坑，如果有有別一個 position: fixed 會出現奇怪的問題。現在頁面改成下面的方案二，雖然不支持IE，但減少了JS 代碼，而且css 代碼更清𥇦。<br><br><br><br><br><br><b","link":"","raw":null,"photos":["/2018/11/29/如何把頁眉-header-置頂/68295053_p0_master1200.jpg"],"source":"_posts/2018/11/29-如何把頁眉-header-置頂.md","categories":[{"name":"Front-end","slug":"Front-end","count":4,"path":"api/categories/Front-end.json"},{"name":"CSS","slug":"Front-end/CSS","count":1,"path":"api/categories/Front-end/CSS.json"}],"tags":[]},{"_id":"cjp28lh2l0000trnwww5xgz0y","title":"使用CDN把Shadowsocks主機的實體IP隱藏","slug":"使用CDN把SS主機的實體IP隱藏","date":"2018-11-29T11:06:02.000Z","updated":"2018-11-29T12:51:52.012Z","comments":true,"permalink":"/2018/11/29/使用CDN把SS主機的實體IP隱藏/","path":"api/articles/使用CDN把SS主機的實體IP隱藏.json","excerpt":"","keywords":null,"cover":null,"content":"<p>一般Shadowsocks 機場，直接到服務器的真實IP，這種VPS服務器的IP 段都是連著的，出較出名的VPS服務商的IP 段很易被掃出來，之後被各種DDOS或暴力破解。</p>\n<p>使用CDN反代就可以把IP 隱藏起來，也可以把被GFW 封了的IP 段機器再利用。別外加上Nginx 反代可以把Shadowsocks 偽裝成網站頁面，或跳轉到別的頁面。</p>\n<h3 id=\"Shadowsocks-配置\"><a href=\"#Shadowsocks-配置\" class=\"headerlink\" title=\"Shadowsocks 配置\"></a>Shadowsocks 配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ss-server -s 0.0.0.0 -p 8080 -c config.json --fast-open --plugin obfs-server --plugin-opts <span class=\"string\">\"obfs=http\"</span></span><br></pre></td></tr></table></figure>\n<p>Ps: obfs使用 http 不要使用 tls，因為CDN 的https會做了別一重的tls封裝，引致解密失敗。</p>\n<blockquote>\n<p>Cloudflare 支持直接的端口</p>\n</blockquote>\n<p><code>80, 8080, 8880, 2052, 2082, 2086, 2095</code></p>\n<p><del>如果使用 Cloudflare 強制 https/tls, 可以在page rules 把需使用的域名加入例外規則。</del></p>\n<p>在 Cloudflare 上需要在 Crypto 關閉 Always Use HTTPS，不然 http 流量會強制跳到 https</p>\n<p>如果使用Nginx 作為反代過濾，可以把非 SS連接跳轉到別的頁面</p>\n<h3 id=\"Nginx-配置\"><a href=\"#Nginx-配置\" class=\"headerlink\" title=\"Nginx 配置\"></a>Nginx 配置</h3><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br><span class=\"line\" data-line-number=\"19\"></span><br><span class=\"line\" data-line-number=\"20\"></span><br><span class=\"line\" data-line-number=\"21\"></span><br><span class=\"line\" data-line-number=\"22\"></span><br><span class=\"line\" data-line-number=\"23\"></span><br><span class=\"line\" data-line-number=\"24\"></span><br><span class=\"line\" data-line-number=\"25\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">map</span> <span class=\"variable\">$http_upgrade</span> <span class=\"variable\">$connection_upgrade</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">default</span> upgrade;</span><br><span class=\"line\">    ''      close;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span> ssl;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span>       TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span>         HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    <span class=\"attribute\">server_name</span>         __server_name__;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_redirect</span>      <span class=\"literal\">off</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_http_version</span>  <span class=\"number\">1</span>.<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span>    Upgrade <span class=\"variable\">$http_upgrade</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span>    Connection <span class=\"variable\">$connection_upgrade</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span>    Host <span class=\"variable\">$http_host</span>;</span><br><span class=\"line\">        <span class=\"attribute\">if</span> (<span class=\"variable\">$http_upgrade</span> = <span class=\"string\">\"websocket\"</span>)&#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span>          http://192.168.0.118:10000;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"attribute\">if</span> (<span class=\"variable\">$scheme</span> = <span class=\"string\">\"http\"</span>)&#123;</span><br><span class=\"line\">            <span class=\"attribute\">return</span> <span class=\"number\">301</span> https://<span class=\"variable\">$http_host</span><span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果使用Nginx 反代，Andorid 的 simple-obfs 的版本使用的 obfs-local 是0.0.2 對 websocket的支持不完整。</p>\n<p>需要更新到最新版本的 obfs-local</p>\n<p><a href=\"https://github.com/Tsuki/simple-obfs-android/releases/download/0.0.6/obfs-local-release.apk\" target=\"_blank\" rel=\"noopener\">https://github.com/Tsuki/simple-obfs-android/releases/download/0.0.6/obfs-local-release.apk</a></p>\n","text":"一般Shadowsocks 機場，直接到服務器的真實IP，這種VPS服務器的IP 段都是連著的，出較出名的VPS服務商的IP 段很易被掃出來，之後被各種DDOS或暴力破解。使用CDN反代就可以把IP 隱藏起來，也可以把被GFW 封了的IP 段機器再利用。別外加上Nginx 反代可","link":"","raw":null,"photos":["/2018/11/29/使用CDN把SS主機的實體IP隱藏/photo_2018-11-29_11-12-19.jpg"],"source":"_posts/2018/11/29-使用CDN把SS主機的實體IP隱藏.md","categories":[{"name":"Server","slug":"Server","count":1,"path":"api/categories/Server.json"}],"tags":[]},{"_id":"cjnain3wr0000u4pl9backu10","title":"在PostgresSQL啟用不區分大小寫欄位","slug":"在PostgresSQL啟用不區分大小寫欄位","date":"2018-10-15T17:53:24.000Z","updated":"2018-10-15T16:31:00.862Z","comments":true,"permalink":"/2018/10/15/在PostgresSQL啟用不區分大小寫欄位/","path":"api/articles/在PostgresSQL啟用不區分大小寫欄位.json","excerpt":"","keywords":null,"cover":null,"content":"<p>在PostgreSQL 上建立欄位約束，是很簡單的事情，</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> (  </span><br><span class=\"line\">  <span class=\"keyword\">id</span>     <span class=\"keyword\">uuid</span> PRIMARY <span class=\"keyword\">KEY</span> <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">DEFAULT</span> uuid_generate_v4(),</span><br><span class=\"line\">  email  <span class=\"built_in\">text</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>我們只需要在表的欄位上加入唯一約束就可以，如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> <span class=\"keyword\">ADD</span> <span class=\"keyword\">CONSTRAINT</span> email_unique <span class=\"keyword\">UNIQUE</span> (email);</span><br></pre></td></tr></table></figure>\n<p>但在特殊情況下，我們需要不區分大少寫的欄位，比如用戶表等。。。剛剛那種約速方法就不再有效，因為PostgreSQL 預設是大小寫區分的。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'test@example.com'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'TEST@example.com'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">from</span> <span class=\"keyword\">users</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                  id                  |      email       </span><br><span class=\"line\"><span class=\"comment\">--------------------------------------+------------------</span></span><br><span class=\"line\"> ccfcddd2-bdc5-4cf4-9475-4171960e6262 | test@example.com</span><br><span class=\"line\"> 431308b4-8df8-44c9-bed4-7c44cf4e1ec1 | TEST@example.com</span><br><span class=\"line\">(2 rows)</span><br></pre></td></tr></table></figure>\n<p>一般情況下，我們會使用 <code>Lower</code> 和 <code>ToLower</code>  建立唯一索引和尋找數據。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> emailunique_idx <span class=\"keyword\">on</span> <span class=\"keyword\">users</span> (<span class=\"keyword\">LOWER</span>(email)); </span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"keyword\">users</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">LOWER</span>(email) = <span class=\"keyword\">LOWER</span>(?);</span><br></pre></td></tr></table></figure>\n<p>但這種做法，忘了加 <code>LOWER</code> 就會令程序產生 Bug.</p>\n<p>其實 PostgreSQL 供提不少額外的模塊，只是沒有預設啟用。這裹說的 <code>CITEXT</code> 就是其中一個。<code>CITEXT</code> 顧名思義就是 <code>case insensitive text</code>。</p>\n<p>首先在 PostgreSQL 啟用額外的<code>CITEXT</code>模組。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> EXTENSION <span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> citext;</span><br></pre></td></tr></table></figure>\n<p>之後清空之前加入的數據，並修改 <code>email</code> 欄位屬情為 <code>citext</code>.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">TRUNCATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> RESTART <span class=\"keyword\">IDENTITY</span> RESTRICT;</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> <span class=\"keyword\">ALTER</span> <span class=\"keyword\">COLUMN</span> email <span class=\"keyword\">TYPE</span> citext;</span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> emailunique_idx <span class=\"keyword\">on</span> <span class=\"keyword\">users</span> (email);</span><br></pre></td></tr></table></figure>\n<p>之後再一次插入用戶數據，就可以看到樣同 <code>email</code> 並不能成功加入，並抛出錯誤。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'test@example.com'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'TEST@example.com'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">ERROR:  duplicate key value violates unique constraint \"email_unique\"  </span><br><span class=\"line\">DETAIL:  Key (email)=(TEST@example.com) already exists.</span><br></pre></td></tr></table></figure>\n<p>這種做法的好處是，欄位中己配置好檢查，不需要在代碼中每一次手動加上檢查，在數據庫的欄位上作出最後一道防線。別一方面，其他開發人員看到表的 <code>DDL</code> 時就明白這個欄位是不區分大少寫。</p>\n<p>最後這個模組是從 <code>PostgreSQL 9.3</code> 開始提供。</p>\n<p>Ref: <a href=\"http://shuber.io/case-insensitive-unique-constraints-in-postgres/\" target=\"_blank\" rel=\"noopener\">http://shuber.io/case-insensitive-unique-constraints-in-postgres/</a></p>\n","text":"在PostgreSQL 上建立欄位約束，是很簡單的事情，<br><br><br><br>CREATE TABLE users (  <br>  id     uuid PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),<br>  em","link":"","raw":null,"photos":["/2018/10/15/在PostgresSQL啟用不區分大小寫欄位/photo_2018-10-05_23-48-11.jpg"],"source":"_posts/2018/10/15-在PostgresSQL啟用不區分大小寫欄位.md","categories":[{"name":"SQL","slug":"SQL","count":2,"path":"api/categories/SQL.json"}],"tags":[]},{"_id":"cjmq4sgcp0000txpfmcnsid2z","title":"升級到macOS Mojave","slug":"升級到macOS-Mojave","date":"2018-10-01T17:56:53.000Z","updated":"2018-10-01T10:07:37.100Z","comments":true,"permalink":"/2018/10/01/升級到macOS-Mojave/","path":"api/articles/升級到macOS-Mojave.json","excerpt":"","keywords":null,"cover":null,"content":"<p>今天把筆記本升級到 Mojave，有Dark theme 看起來舒服多了，雖然還有部分軟件不支持。</p>\n<p>這次升級需時有點久，升了近一小時。而且升級後把 CommandLineTool刪了，需要重新下載。</p>\n<p><code>sudo xcode-select --install</code></p>\n","text":"今天把筆記本升級到 Mojave，有Dark theme 看起來舒服多了，雖然還有部分軟件不支持。這次升級需時有點久，升了近一小時。而且升級後把 CommandLineTool刪了，需要重新下載。sudo xcode-select --install","link":"","raw":null,"photos":["/2018/10/01/升級到macOS-Mojave/nadeshiko-kagamihara-4k-9b-1280x720.jpg"],"source":"_posts/2018/10/01-升級到macOS-Mojave.md","categories":[{"name":"日記","slug":"日記","count":20,"path":"api/categories/日記.json"}],"tags":[]},{"_id":"cjmklhtpp0000tsqjzf8qt81h","title":"Casbin-訪問權限控制工具","slug":"casbin-訪問權限控制工具","date":"2018-09-26T20:51:25.000Z","updated":"2018-09-27T13:08:43.994Z","comments":true,"permalink":"/2018/09/26/casbin-訪問權限控制工具/","path":"api/articles/casbin-訪問權限控制工具.json","excerpt":"","keywords":null,"cover":null,"content":"<p>Casbin 本質是一個配對的權限的工具庫，主要是由 model 模型和 policy 政策組成，</p>\n<p>model example</p>\n<p>r 是接受傳入的參數並定義欄位，例子中接受三項參數</p>\n<p>p 是解析 Prolicy 內容並定義欄位</p>\n<p>m 是配對 Policy 方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[request_definition]</span><br><span class=\"line\">r = sub, obj, act</span><br><span class=\"line\"></span><br><span class=\"line\">[policy_definition]</span><br><span class=\"line\">p = sub, obj, act</span><br><span class=\"line\"></span><br><span class=\"line\">[policy_effect]</span><br><span class=\"line\">e = some(where (p.eft == allow))</span><br><span class=\"line\"></span><br><span class=\"line\">[matchers]</span><br><span class=\"line\">m = (p.sub in r.sub || p.sub == &quot;*&quot;) &amp;&amp; keyMatch(r.obj, p.obj) &amp;&amp; (r.act == p.act || p.act == &quot;*&quot;)</span><br></pre></td></tr></table></figure>\n<p>policy example </p>\n<p>ps:雖然是csv格式 但需要在逗號後留空白，別外內容的空白是會保留，不要因為對齊而加padding</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">p, *, /info, GET</span><br><span class=\"line\">p, user, /users, GET</span><br><span class=\"line\">p, user, /users, POST</span><br><span class=\"line\">p, setting, /settings, *</span><br></pre></td></tr></table></figure>\n","text":"Casbin 本質是一個配對的權限的工具庫，主要是由 model 模型和 policy 政策組成，model exampler 是接受傳入的參數並定義欄位，例子中接受三項參數p 是解析 Prolicy 內容並定義欄位m 是配對 Policy 方式<br><br><br><br><","link":"","raw":null,"photos":["/2018/09/26/casbin-訪問權限控制工具/anime-love-live-sunshine-a9-1280x720.jpg"],"source":"_posts/2018/09/26-casbin-訪問權限控制工具.md","categories":[{"name":"Golang","slug":"Golang","count":3,"path":"api/categories/Golang.json"}],"tags":[]},{"_id":"cjmg3xrq30000ttmo9c172s81","title":"刪了Xcode後不能使用make等指令","slug":"刪了xcode後不能使用make等指令","date":"2018-09-24T17:43:26.000Z","updated":"2018-09-27T13:08:43.994Z","comments":true,"permalink":"/2018/09/24/刪了xcode後不能使用make等指令/","path":"api/articles/刪了xcode後不能使用make等指令.json","excerpt":"","keywords":null,"cover":null,"content":"<p>如果出現以下內容</p>\n<blockquote>\n<p>xcrun: error: active developer path (“/Applications/Xcode.app/Contents/Developer”) does not exist</p>\n</blockquote>\n<p>輸入 <code>sudo xcode-select -s /Library/Developer/CommandLineTools</code> 改回使用 CommandLineTools 的路徑</p>\n","text":"如果出現以下內容xcrun: error: active developer path (“/Applications/Xcode.app/Contents/Developer”) does not exist輸入 sudo xcode-select -s /Library/De","link":"","raw":null,"photos":[],"source":"_posts/2018/09/24-刪了xcode後不能使用make等指令.md","categories":[{"name":"ops","slug":"ops","count":1,"path":"api/categories/ops.json"}],"tags":[]},{"_id":"cjmbv10s30000tso75ms0x3o4","title":"前端好用的模糊搜索工具","slug":"前端好用的模糊搜索工具","date":"2018-09-21T17:55:43.000Z","updated":"2018-09-21T10:25:31.993Z","comments":true,"permalink":"/2018/09/21/前端好用的模糊搜索工具/","path":"api/articles/前端好用的模糊搜索工具.json","excerpt":"","keywords":null,"cover":null,"content":"<p><a href=\"https://github.com/krisk/fuse\" target=\"_blank\" rel=\"noopener\">https://github.com/krisk/fuse</a></p>\n<p><a href=\"http://fusejs.io/\" target=\"_blank\" rel=\"noopener\">http://fusejs.io/</a></p>\n<p>在處理表單的全文搜索，很常都要對不同欄位過濾，用了Fuse.js就可以少寫很多代碼。</p>\n<p>Fuse.js 除了支持指定欄位/嵌套 Json，還支持比重搜索和 Bitap 算法提供一定近似匹配的功能。</p>\n<p><a href=\"http://fusejs.io/#examples\" target=\"_blank\" rel=\"noopener\">http://fusejs.io/#examples</a></p>\n","text":"https://github.com/krisk/fusehttp://fusejs.io/在處理表單的全文搜索，很常都要對不同欄位過濾，用了Fuse.js就可以少寫很多代碼。Fuse.js 除了支持指定欄位/嵌套 Json，還支持比重搜索和 Bitap 算法提供一定近似匹配的功","link":"","raw":null,"photos":["/2018/09/21/前端好用的模糊搜索工具/anime-touhou-sagume-kishin-wings-dz-1280x720.jpg"],"source":"_posts/2018/09/21-前端好用的模糊搜索工具.md","categories":[{"name":"Front-end","slug":"Front-end","count":4,"path":"api/categories/Front-end.json"},{"name":"JavaScript","slug":"Front-end/JavaScript","count":2,"path":"api/categories/Front-end/JavaScript.json"}],"tags":[]},{"_id":"cjmal22370000tpnyeodvqbc1","title":"SQL語法中的過濾方法","slug":"SQL語法中的過濾方法","date":"2018-09-20T20:17:49.000Z","updated":"2018-09-20T12:58:44.135Z","comments":true,"permalink":"/2018/09/20/SQL語法中的過濾方法/","path":"api/articles/SQL語法中的過濾方法.json","excerpt":"","keywords":null,"cover":null,"content":"<p>在統計系統中，很常用到不同維度的分類和過澽，</p>\n<p>比如按類加總/平均等等</p>\n<table>\n<thead>\n<tr>\n<th>Id</th>\n<th>Gender</th>\n<th>Salary</th>\n<th>Country</th>\n<th>Position</th>\n<th>Status</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>M</td>\n<td>1000</td>\n<td>China</td>\n<td>Software</td>\n<td>working</td>\n</tr>\n<tr>\n<td>2</td>\n<td>F</td>\n<td>2000</td>\n<td>USA</td>\n<td>Software</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>3</td>\n<td>M</td>\n<td>5000</td>\n<td>UK</td>\n<td>Hardware</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>4</td>\n<td>F</td>\n<td>4000</td>\n<td>Germany</td>\n<td>Hardware</td>\n<td>working</td>\n</tr>\n<tr>\n<td>5</td>\n<td>M</td>\n<td>5000</td>\n<td>USA</td>\n<td>Admin</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>6</td>\n<td>F</td>\n<td>4000</td>\n<td>Germany</td>\n<td>Admin</td>\n<td>holiday</td>\n</tr>\n</tbody>\n</table>\n<p>如果在上要一次過找出Admin和非Admin人員的平均Salary可以在 SQL中用 filter 或 case</p>\n<p>PostgreSQL</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(salary) filter (<span class=\"keyword\">where</span> <span class=\"keyword\">position</span> = <span class=\"string\">'admin'</span>)  <span class=\"keyword\">as</span> admin_avg_salary,</span><br><span class=\"line\">       <span class=\"keyword\">avg</span>(salary) filter (<span class=\"keyword\">where</span> <span class=\"keyword\">position</span> &lt;&gt; <span class=\"string\">'admin'</span>) <span class=\"keyword\">as</span> non_admin_avg_salary</span><br><span class=\"line\"><span class=\"keyword\">from</span> raw_data</span><br></pre></td></tr></table></figure>\n<p>MySQL</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(salary <span class=\"keyword\">CASE</span></span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> <span class=\"keyword\">position</span> = <span class=\"string\">'admin'</span> <span class=\"keyword\">THEN</span> salary</span><br><span class=\"line\">                    <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> <span class=\"keyword\">END</span>) <span class=\"keyword\">as</span> admin_avg_salary,</span><br><span class=\"line\">       <span class=\"keyword\">avg</span>(salary <span class=\"keyword\">CASE</span></span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> <span class=\"keyword\">position</span> &lt;&gt; <span class=\"string\">'admin'</span> <span class=\"keyword\">THEN</span> salary</span><br><span class=\"line\">                    <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> <span class=\"keyword\">END</span>) <span class=\"keyword\">as</span> non_admin_avg_salary</span><br><span class=\"line\"><span class=\"keyword\">from</span> raw_data</span><br></pre></td></tr></table></figure>\n","text":"在統計系統中，很常用到不同維度的分類和過澽，比如按類加總/平均等等IdGenderSalaryCountryPositionStatus1M1000ChinaSoftwareworking2F2000USASoftwareholiday3M5000UKHardwareholida","link":"","raw":null,"photos":["/2018/09/20/SQL語法中的過濾方法/121654695498494.jpg"],"source":"_posts/2018/09/20-SQL語法中的過濾方法.md","categories":[{"name":"SQL","slug":"SQL","count":2,"path":"api/categories/SQL.json"}],"tags":[]},{"_id":"cjlenu7du0000u5ms981wunyh","title":"gorm兼容net.IP類","slug":"gorm兼容net-IP類","date":"2018-08-29T12:04:38.000Z","updated":"2018-08-29T06:37:22.933Z","comments":true,"permalink":"/2018/08/29/gorm兼容net-IP類/","path":"api/articles/gorm兼容net-IP類.json","excerpt":"","keywords":null,"cover":null,"content":"<p>首先 alias net.IP類到本地包，為之後實作方法。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> IP net.IP</span><br></pre></td></tr></table></figure>\n<p>因為pg不能直接使用<code>[]byte</code>作為輸入，所以需要實作<code>Value()</code>令Gorm 能轉換成字串作為輸入。</p>\n<p>先從自定義的 <code>IP</code> 類轉換回 <code>net.IP</code> 類，再用 <code>String()</code> 轉成字串。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a IP)</span> <span class=\"title\">Value</span><span class=\"params\">()</span> <span class=\"params\">(driver.Value, error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> net.IP(a).String(), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 別外，由於從pg 內讀取出來的是 <code>[]unit8</code> 類，內部數據是 ASIIC 碼，所以先轉換成 byte合併成 Array 再轉成 string.</p>\n<p> 最後用 net 庫內的 ParseIP 方法 轉成 IP 類，之後再 cast 成自定義的 IP 類 返回。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> IP net.IP</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a *IP)</span> <span class=\"title\">Scan</span><span class=\"params\">(src <span class=\"keyword\">interface</span>&#123;&#125;)</span> <span class=\"title\">error</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> x := src.(<span class=\"keyword\">type</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> []<span class=\"keyword\">uint8</span>:</span><br><span class=\"line\">\t\t*a = IP(net.ParseIP(<span class=\"keyword\">string</span>(x)))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"literal\">nil</span>:</span><br><span class=\"line\">\t\t*a = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">\"pq: cannot convert %T to net.IP\"</span>, src)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(a IP)</span> <span class=\"title\">Value</span><span class=\"params\">()</span> <span class=\"params\">(driver.Value, error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> net.IP(a).String(), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","text":"首先 alias net.IP類到本地包，為之後實作方法。<br>type IP net.IP<br>因為pg不能直接使用[]byte作為輸入，所以需要實作Value()令Gorm 能轉換成字串作為輸入。先從自定義的 IP 類轉換回 net.IP 類，再用 String() 轉成","link":"","raw":null,"photos":["/2018/08/29/gorm兼容net-IP類/photo_2018-08-29_12-08-58.jpg"],"source":"_posts/2018/08/29-gorm兼容net-IP類.md","categories":[{"name":"Golang","slug":"Golang","count":3,"path":"api/categories/Golang.json"}],"tags":[]}]}