{"total":55,"pageSize":10,"pageCount":6,"data":[{"_id":"cjptfo1m70000iuqb2tzgt2j0","title":"在Angular動態加載html","slug":"在Angular動態加載html","date":"2018-12-17T19:21:15.000Z","updated":"2018-12-18T07:34:52.135Z","comments":true,"permalink":"/2018/12/17/在Angular動態加載html/","path":"api/articles/在Angular動態加載html.json","excerpt":"","keywords":null,"content":"<h3 id=\"原生靜態-HTML\"><a href=\"#原生靜態-HTML\" class=\"headerlink\" title=\"原生靜態 HTML\"></a>原生靜態 HTML</h3><p>使用 <code>innerHtml</code> 直接取代原生 element.</p><p>但如果 HTML 內有 inline style 或 sciprt, 這就需要 <code>DomSanitizer</code> 進行 <code>bypassSecurityTrustHtml</code>.</p><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;Pipe, PipeTransform&#125; <span class=\"keyword\">from</span> <span class=\"string\">'@angular/core'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;DomSanitizer&#125; <span class=\"keyword\">from</span> <span class=\"string\">\"@angular/platform-browser\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Pipe</span>(&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'safeHtml'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SafeHtmlPipe <span class=\"keyword\">implements</span> PipeTransform &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> sanitizer: DomSanitizer</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  transform(value: <span class=\"built_in\">any</span>, args?: <span class=\"built_in\">any</span>): <span class=\"built_in\">any</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.sanitizer.bypassSecurityTrustHtml(value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> [<span class=\"attr\">innerHtml</span>]=<span class=\"string\">\"post.content|safeHtml\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id=\"非原生-HTML\"><a href=\"#非原生-HTML\" class=\"headerlink\" title=\"非原生 HTML\"></a>非原生 HTML</h3><p>首先，建立 helper function，以幫助構建 <code>Component</code> 和 <code>Module</code></p><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compileToComponent</span>(<span class=\"params\">template</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> Component(&#123;template&#125;)(<span class=\"keyword\">class</span> &#123;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compileToModule</span>(<span class=\"params\">declarations, imports?</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> NgModule(&#123;declarations, imports&#125;)(<span class=\"keyword\">class</span> &#123;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>之後使用 <code>ViewChild</code> 綁定 <code>ng-template</code> ，最後在 <code>ngAfterViewInit</code> 使用 JITcompile 進行實時編譯並在生成組件。</p><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> PostBodyComponent <span class=\"keyword\">implements</span> OnInit, AfterViewInit &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@ViewChild</span>(<span class=\"string\">'container'</span>, &#123;read: ViewContainerRef&#125;)</span><br><span class=\"line\">  container: ViewContainerRef;</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> compiler: Compiler</span>) &#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit() &#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngAfterViewInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> tmpComponent = compileToComponent(<span class=\"keyword\">this</span>.post.content);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> tmpModule = compileToModule([tmpComponent], [AppModule]);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.compiler.compileModuleAndAllComponentsAsync(tmpModule).then(</span><br><span class=\"line\">      (factories) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> factory = factories.componentFactories.find(<span class=\"function\"><span class=\"params\">f</span> =&gt;</span> f.componentType === tmpComponent);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.container.createComponent(factory);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ng-template</span> #<span class=\"attr\">container</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>由於 Angular 4 之後 AoT 和 Jit 不能並存，所以需要在 <code>angular.json</code> 關閉 aot 和 buildOptimizer。</p><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"configurations\": &#123;</span><br><span class=\"line\">  \"production\": &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    \"aot\": false,</span><br><span class=\"line\">    \"buildOptimizer\": false,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","text":"原生靜態 HTML使用 innerHtml 直接取代原生 element.但如果 HTML 內有 inline style 或 sciprt, 這就需要 DomSanitizer 進行 bypassSecurityTrustHtml.1<br>2<br>3<br>4<br>5<b","link":"","raw":null,"photos":[],"source":"_posts/2018/12/17-在Angular動態加載html.md","categories":[],"tags":[]},{"_id":"cjprvto2f0000isp90ki0nr2w","title":"PSV變革","slug":"PSV變革","date":"2018-12-17T10:48:17.000Z","updated":"2018-12-17T05:31:42.346Z","comments":true,"permalink":"/2018/12/17/PSV變革/","path":"api/articles/PSV變革.json","excerpt":"","keywords":null,"content":"<h1 id=\"Make-PSV-great-again\"><a href=\"#Make-PSV-great-again\" class=\"headerlink\" title=\"Make PSV great again\"></a>Make PSV great again</h1><p>HENkaku (變革) 令 PSV 如同 PSP 時代一樣強大起來。</p><h2 id=\"準備\"><a href=\"#準備\" class=\"headerlink\" title=\"準備\"></a>準備</h2><p>一台 PSV，如果是 PSV 1000 需要額外的 Sony 記憶卡（因為 1000 沒有內部儲存空間</p><h2 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h2><p>由於變革不是永久性/固化的漏洞（），因此只支持版本 3.65 ~ 3.68 ，如果己升級到 3.69 下文就不再適用。</p><p>如果版本在 3.65 以下，可以使用修改 DNS 方法更新，比如 <code>23.96.6.207</code> ，修改之後更新包會變成 <code>3.65 (変革 Compatible)</code> 。</p><h2 id=\"安裝\"><a href=\"#安裝\" class=\"headerlink\" title=\"安裝\"></a>安裝</h2><h3 id=\"Windows-用戶\"><a href=\"#Windows-用戶\" class=\"headerlink\" title=\"Windows 用戶\"></a>Windows 用戶</h3><p>如果使用 Windows 安裝，只需要下載 <a href=\"https://github.com/noahc3/auto-h-encore\" target=\"_blank\" rel=\"noopener\">auto h-encore</a> 就可以完成大部分前置準備工作，自動下載 QCMA，DEOM，解包，修改包內容，重新打包等工作。</p><p>打開 auto h-encore 只需要點 start 等待下載完成所需工具後，會提示安裝 QCMA，建意便用 USB 驅動安裝。</p><p>安裝好 QCMA 後，會自動進行置換DEOM包的工具，完成之後打開 OCMA 工具 並接上 PSV USB到電腦。</p><p>其後在 PSV 打開內容管理，選 USB 傳輸，再記 PC 到 PSV，最後把打包好的 h-encore 傳到PSV上。</p><h3 id=\"macOS-Linux-用戶\"><a href=\"#macOS-Linux-用戶\" class=\"headerlink\" title=\"macOS/Linux 用戶\"></a>macOS/Linux 用戶</h3><p>使用 <a href=\"https://github.com/soarqin/finalhe\" target=\"_blank\" rel=\"noopener\">finalhe</a> ，因為沒使用過，就不詳細說了。</p><h2 id=\"變革\"><a href=\"#變革\" class=\"headerlink\" title=\"變革\"></a>變革</h2><p>在 Live Area 下打開 H-encore，進入 bootstrap menu, 之後在菜單上選擇 Install HENkaku。</p><p>完成之後，強烈建意安裝，選擇 <code>Download VitaShell</code>（需要WI-FI連網），因為很多情況下都需要使用上。</p><p>最後，回到 <code>Exit</code> 退回 Live Area，之後打開設定，菜單上會多了一項 HENkaku 設置，進入後啟動 <strong>啟動不安全自制軟件</strong>。</p><h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul><li><a href=\"https://github.com/TheOfficialFloW/NoNpDrm/releases\" target=\"_blank\" rel=\"noopener\">NoNpDrm</a> <em>(允許使用已加密的遊戲及應用程式)</em></li><li><a href=\"https://github.com/Applelo/SwitchSD2Vita/releases\" target=\"_blank\" rel=\"noopener\">SwitchSD2Vita</a> <em>(使用 sd2vita 卡帶代替Sony 記憶卡)</em></li><li><a href=\"https://github.com/blastrock/pkgj/releases\" target=\"_blank\" rel=\"noopener\">PKGj</a> <em>(提供網上下載 PSV PSP PSX PSM遊戲/ PSV DLC功能)</em></li><li><a href=\"https://github.com/ONElua/AccountManager/releases\" target=\"_blank\" rel=\"noopener\">AccountManager</a> (提供備分轉換 PSV 內的 PSN 功能)</li></ul><p>以上除了 NoNpDrm 都是使用 vpk 格式安裝，只需要在 VITAShell 下點選安裝就可以。</p><h3 id=\"NoNpDrm\"><a href=\"#NoNpDrm\" class=\"headerlink\" title=\"NoNpDrm\"></a>NoNpDrm</h3><p>NoNpDrm安裝，需要在 VITAShell 下打開並修改 <code>ux0:tai/config.txt</code> ，</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*KERNEL</span><br><span class=\"line\">ux0:tai/nonpdrm.skprx</span><br></pre></td></tr></table></figure><p>之後保存重啟 PSV，再重新進了 h-encore，之後 Exit, 不需要再選擇 <code>Install HENkaku</code></p><p>###AccountManager</p><p>轉換帳號前，盡可能先保存當前帳號 ，之到 <code>HENkaku 設置</code> 解除記憶卡/內存綁定，或使用 <code>VITAShell</code> 在 ur0 或 uma0 下刪除 id.dat。不然換轉帳號後不能讀取記憶卡/內存上的 H-encore 引導。</p>","text":"Make PSV great againHENkaku (變革) 令 PSV 如同 PSP 時代一樣強大起來。準備一台 PSV，如果是 PSV 1000 需要額外的 Sony 記憶卡（因為 1000 沒有內部儲存空間更新由於變革不是永久性/固化的漏洞（），因此只支持版本 3.65","link":"","raw":null,"photos":["/2018/12/17/PSV變革/cjpr7k6o2000g4u8h548c6i4l.720p.jpg"],"source":"_posts/2018/12/17-PSV變革.md","categories":[],"tags":[]},{"_id":"cjppa2nzf0000m7o00agja9xn","title":"Angular-起動時加入Async和defer","slug":"Angular-起動時加入async和defer","date":"2018-12-15T13:40:11.000Z","updated":"2018-12-18T07:34:52.135Z","comments":true,"permalink":"/2018/12/15/Angular-起動時加入async和defer/","path":"api/articles/Angular-起動時加入async和defer.json","excerpt":"","keywords":null,"content":"<p>首先，在 Angular 不 Eject 的情況下，使用其他的 Webpack plugin，這樣需要引入 ngx-build-plus。</p><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install ngx-build-plus</span><br></pre></td></tr></table></figure><p>之後在 angular.json 替換 angular-cli 本來的引導指令</p><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  <span class=\"string\">\"architect\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"builder\"</span>: <span class=\"string\">\"ngx-build-plus:build\"</span>,</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"string\">\"serve\"</span>: &#123;</span><br><span class=\"line\">       <span class=\"string\">\"builder\"</span>: <span class=\"string\">\"ngx-build-plus:dev-server\"</span>,</span><br><span class=\"line\">       ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure><p>別外，在目錄下加入額外的 Webpack 配置文件 <code>webpack.extra.js</code></p><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> ScriptExtHtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'script-ext-html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> METADATA = &#123;</span><br><span class=\"line\">  baseUrl: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      template: <span class=\"string\">'src/index.html'</span>,</span><br><span class=\"line\">      chunks: [<span class=\"string\">'styles'</span>, <span class=\"string\">'runtime'</span>, <span class=\"string\">'polyfills'</span>, <span class=\"string\">'main'</span>],</span><br><span class=\"line\">      chunksSortMode: <span class=\"string\">'manual'</span>,</span><br><span class=\"line\">      metadata: METADATA,</span><br><span class=\"line\">      inject: <span class=\"string\">'head'</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> ScriptExtHtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      defaultAttribute: <span class=\"string\">'defer'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p>~~ 由於 Angular 的 <code>zone.js</code> 需要比其他的 js 先載入，所以 polyfills 使用 <code>async</code>，而其他使用 <code>defer</code></p><p>這樣配置就可以把 <code>polyfills.js</code> 以外的 script 都加上 <code>defer</code> 屬性。~~</p><p>把 <code>chunksSortMode</code> 改成 manual, 這樣就會按 <code>chunks</code> 的排序。</p><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"string\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: <span class=\"string\">\"ng build --prod --extraWebpackConfig webpack.extra.js\"</span>,</span><br><span class=\"line\">\t...</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure><p>最後修改 <code>package.json</code> 的 <code>build</code></p><p><a href=\"https://github.com/angular/angular-cli/blob/master/packages/angular_devkit/build_angular/src/angular-cli-files/plugins/index-html-webpack-plugin.ts\" target=\"_blank\" rel=\"noopener\">Angular 官方配置</a></p>","text":"首先，在 Angular 不 Eject 的情況下，使用其他的 Webpack plugin，這樣需要引入 ngx-build-plus。1<br>npm install ngx-build-plus<br>之後在 angular.json 替換 angular-cli 本來的引","link":"","raw":null,"photos":["/2018/12/15/Angular-起動時加入async和defer/cjp40c7j60006wo8hur6fyehw.720p.jpg"],"source":"_posts/2018/12/15-Angular-起動時加入async和defer.md","categories":[],"tags":[]},{"_id":"cjpi7shya0000n8o6qswvy3ec","title":"","slug":"主題遷移到-Angular-進度","date":"2018-12-10T16:27:32.000Z","updated":"2018-12-17T13:10:52.633Z","comments":true,"permalink":"/2018/12/10/主題遷移到-Angular-進度/","path":"api/articles/主題遷移到-Angular-進度.json","excerpt":"","keywords":null,"content":"<h1 id=\"安格拉絲-Angular\"><a href=\"#安格拉絲-Angular\" class=\"headerlink\" title=\"安格拉絲 / Angular\"></a>安格拉絲 / Angular</h1><blockquote><p>大紮好，我系 <a href=\"https://github.com/Tsuki/\" target=\"_blank\" rel=\"noopener\">Tsuki</a>，安格拉絲，介四里沒有挽過的船新版本，擠需體驗三番鍾，里造會幹我一樣，愛象節款框架。</p></blockquote><p>進度</p><ul><li style=\"list-style:none\"><input type=\"checkbox\" checked> Header (完成)</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Pages (完成)</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Article (完成)</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Header 動畫 (完成)</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Pages 動畫 (完成)</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Footer (完成)</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Article 前後頁</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Markdown Todo-list</li><li style=\"list-style:none\"><input type=\"checkbox\" checked> Post page</li><li style=\"list-style:none\"><input type=\"checkbox\"> mobile</li><li style=\"list-style:none\"><input type=\"checkbox\"> Cate/Tag/Archive</li><li style=\"list-style:none\"><input type=\"checkbox\"> Side menu</li><li style=\"list-style:none\"><input type=\"checkbox\"> APlayer</li><li style=\"list-style:none\"><input type=\"checkbox\"> 優化 moment.js</li><li style=\"list-style:none\"><input type=\"checkbox\"> 動態注入配置</li><li style=\"list-style:none\"><input type=\"checkbox\"> 評論數</li><li style=\"list-style:none\"><input type=\"checkbox\"> FancyBox 效果</li><li style=\"list-style:none\"><input type=\"checkbox\"> Article 置頂跑馬燈</li><li style=\"list-style:none\"><input type=\"checkbox\"> Badge count</li></ul>","text":"安格拉絲 / Angular大紮好，我系 Tsuki，安格拉絲，介四里沒有挽過的船新版本，擠需體驗三番鍾，里造會幹我一樣，愛象節款框架。進度 Header (完成) Pages (完成) Article (完成) Header 動畫 (完成) Pages 動畫 (完成) Foot","link":"","raw":null,"photos":["/2018/12/10/主題遷移到-Angular-進度/cjp8n1vtm000kwo8he3x00hiv.720p.jpg"],"source":"_posts/2018/12/10-主題遷移到-Angular-進度.md","categories":[],"tags":[]},{"_id":"cjp2c12n60000twl1iwsbrpy5","title":"如何把頁眉(Header)置頂","slug":"如何把頁眉-header-置頂","date":"2018-11-29T14:59:03.000Z","updated":"2018-11-29T08:23:17.100Z","comments":true,"permalink":"/2018/11/29/如何把頁眉-header-置頂/","path":"api/articles/如何把頁眉-header-置頂.json","excerpt":"","keywords":null,"content":"<h3 id=\"方案一：兼容IE\"><a href=\"#方案一：兼容IE\" class=\"headerlink\" title=\"方案一：兼容IE\"></a>方案一：兼容IE</h3><p>這個方案並不完美，position: fixed 太多坑，如果有有別一個 position: fixed 會出現奇怪的問題。</p>\n<p>現在頁面改成下面的方案二，雖然不支持IE，但減少了JS 代碼，而且css 代碼更清𥇦。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.sticky</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">5000</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.sticky</span> + <span class=\"selector-class\">.main</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">padding-top</span>: <span class=\"number\">92px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br><span class=\"line\" data-line-number=\"19\"></span><br><span class=\"line\" data-line-number=\"20\"></span><br><span class=\"line\" data-line-number=\"21\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">initSticky();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initSticky</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Get the header</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> header = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"header\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Get the offset position of the navbar</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> sticky = header.offsetTop;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">stickyCheck</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.pageYOffset &gt; sticky) &#123;</span><br><span class=\"line\">      header.classList.add(<span class=\"string\">\"sticky\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      header.classList.remove(<span class=\"string\">\"sticky\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">window</span>.onscroll = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    stickyCheck()</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方案二：不兼容IE\"><a href=\"#方案二：不兼容IE\" class=\"headerlink\" title=\"方案二：不兼容IE\"></a>方案二：不兼容IE</h3><p>直接在本來的 header 把position: fixed改成 sticky 和 top: 0. Javascript 可以去掉</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.header</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: sticky;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">5000</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","text":"方案一：兼容IE這個方案並不完美，position: fixed 太多坑，如果有有別一個 position: fixed 會出現奇怪的問題。現在頁面改成下面的方案二，雖然不支持IE，但減少了JS 代碼，而且css 代碼更清𥇦。<br><br><br><br><br><br><b","link":"","raw":null,"photos":["/2018/11/29/如何把頁眉-header-置頂/68295053_p0_master1200.jpg"],"source":"_posts/2018/11/29-如何把頁眉-header-置頂.md","categories":[{"name":"Front-end","slug":"Front-end","count":4,"path":"api/categories/Front-end.json"},{"name":"CSS","slug":"Front-end/CSS","count":1,"path":"api/categories/Front-end/CSS.json"}],"tags":[]},{"_id":"cjp28lh2l0000trnwww5xgz0y","title":"使用CDN把Shadowsocks主機的實體IP隱藏","slug":"使用CDN把SS主機的實體IP隱藏","date":"2018-11-29T11:06:02.000Z","updated":"2018-11-29T12:51:52.012Z","comments":true,"permalink":"/2018/11/29/使用CDN把SS主機的實體IP隱藏/","path":"api/articles/使用CDN把SS主機的實體IP隱藏.json","excerpt":"","keywords":null,"content":"<p>一般Shadowsocks 機場，直接到服務器的真實IP，這種VPS服務器的IP 段都是連著的，出較出名的VPS服務商的IP 段很易被掃出來，之後被各種DDOS或暴力破解。</p>\n<p>使用CDN反代就可以把IP 隱藏起來，也可以把被GFW 封了的IP 段機器再利用。別外加上Nginx 反代可以把Shadowsocks 偽裝成網站頁面，或跳轉到別的頁面。</p>\n<h3 id=\"Shadowsocks-配置\"><a href=\"#Shadowsocks-配置\" class=\"headerlink\" title=\"Shadowsocks 配置\"></a>Shadowsocks 配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ss-server -s 0.0.0.0 -p 8080 -c config.json --fast-open --plugin obfs-server --plugin-opts <span class=\"string\">\"obfs=http\"</span></span><br></pre></td></tr></table></figure>\n<p>Ps: obfs使用 http 不要使用 tls，因為CDN 的https會做了別一重的tls封裝，引致解密失敗。</p>\n<blockquote>\n<p>Cloudflare 支持直接的端口</p>\n</blockquote>\n<p><code>80, 8080, 8880, 2052, 2082, 2086, 2095</code></p>\n<p><del>如果使用 Cloudflare 強制 https/tls, 可以在page rules 把需使用的域名加入例外規則。</del></p>\n<p>在 Cloudflare 上需要在 Crypto 關閉 Always Use HTTPS，不然 http 流量會強制跳到 https</p>\n<p>如果使用Nginx 作為反代過濾，可以把非 SS連接跳轉到別的頁面</p>\n<h3 id=\"Nginx-配置\"><a href=\"#Nginx-配置\" class=\"headerlink\" title=\"Nginx 配置\"></a>Nginx 配置</h3><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br><span class=\"line\" data-line-number=\"12\"></span><br><span class=\"line\" data-line-number=\"13\"></span><br><span class=\"line\" data-line-number=\"14\"></span><br><span class=\"line\" data-line-number=\"15\"></span><br><span class=\"line\" data-line-number=\"16\"></span><br><span class=\"line\" data-line-number=\"17\"></span><br><span class=\"line\" data-line-number=\"18\"></span><br><span class=\"line\" data-line-number=\"19\"></span><br><span class=\"line\" data-line-number=\"20\"></span><br><span class=\"line\" data-line-number=\"21\"></span><br><span class=\"line\" data-line-number=\"22\"></span><br><span class=\"line\" data-line-number=\"23\"></span><br><span class=\"line\" data-line-number=\"24\"></span><br><span class=\"line\" data-line-number=\"25\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">map</span> <span class=\"variable\">$http_upgrade</span> <span class=\"variable\">$connection_upgrade</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">default</span> upgrade;</span><br><span class=\"line\">    ''      close;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span> ssl;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span>       TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span>         HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    <span class=\"attribute\">server_name</span>         __server_name__;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_redirect</span>      <span class=\"literal\">off</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_http_version</span>  <span class=\"number\">1</span>.<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span>    Upgrade <span class=\"variable\">$http_upgrade</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span>    Connection <span class=\"variable\">$connection_upgrade</span>;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_set_header</span>    Host <span class=\"variable\">$http_host</span>;</span><br><span class=\"line\">        <span class=\"attribute\">if</span> (<span class=\"variable\">$http_upgrade</span> = <span class=\"string\">\"websocket\"</span>)&#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span>          http://192.168.0.118:10000;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"attribute\">if</span> (<span class=\"variable\">$scheme</span> = <span class=\"string\">\"http\"</span>)&#123;</span><br><span class=\"line\">            <span class=\"attribute\">return</span> <span class=\"number\">301</span> https://<span class=\"variable\">$http_host</span><span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果使用Nginx 反代，Andorid 的 simple-obfs 的版本使用的 obfs-local 是0.0.2 對 websocket的支持不完整。</p>\n<p>需要更新到最新版本的 obfs-local</p>\n<p><a href=\"https://github.com/Tsuki/simple-obfs-android/releases/download/0.0.6/obfs-local-release.apk\" target=\"_blank\" rel=\"noopener\">https://github.com/Tsuki/simple-obfs-android/releases/download/0.0.6/obfs-local-release.apk</a></p>\n","text":"一般Shadowsocks 機場，直接到服務器的真實IP，這種VPS服務器的IP 段都是連著的，出較出名的VPS服務商的IP 段很易被掃出來，之後被各種DDOS或暴力破解。使用CDN反代就可以把IP 隱藏起來，也可以把被GFW 封了的IP 段機器再利用。別外加上Nginx 反代可","link":"","raw":null,"photos":["/2018/11/29/使用CDN把SS主機的實體IP隱藏/photo_2018-11-29_11-12-19.jpg"],"source":"_posts/2018/11/29-使用CDN把SS主機的實體IP隱藏.md","categories":[{"name":"Server","slug":"Server","count":1,"path":"api/categories/Server.json"}],"tags":[]},{"_id":"cjnain3wr0000u4pl9backu10","title":"在PostgresSQL啟用不區分大小寫欄位","slug":"在PostgresSQL啟用不區分大小寫欄位","date":"2018-10-15T17:53:24.000Z","updated":"2018-10-15T16:31:00.862Z","comments":true,"permalink":"/2018/10/15/在PostgresSQL啟用不區分大小寫欄位/","path":"api/articles/在PostgresSQL啟用不區分大小寫欄位.json","excerpt":"","keywords":null,"content":"<p>在PostgreSQL 上建立欄位約束，是很簡單的事情，</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> (  </span><br><span class=\"line\">  <span class=\"keyword\">id</span>     <span class=\"keyword\">uuid</span> PRIMARY <span class=\"keyword\">KEY</span> <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">DEFAULT</span> uuid_generate_v4(),</span><br><span class=\"line\">  email  <span class=\"built_in\">text</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>我們只需要在表的欄位上加入唯一約束就可以，如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> <span class=\"keyword\">ADD</span> <span class=\"keyword\">CONSTRAINT</span> email_unique <span class=\"keyword\">UNIQUE</span> (email);</span><br></pre></td></tr></table></figure>\n<p>但在特殊情況下，我們需要不區分大少寫的欄位，比如用戶表等。。。剛剛那種約速方法就不再有效，因為PostgreSQL 預設是大小寫區分的。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'test@example.com'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'TEST@example.com'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">from</span> <span class=\"keyword\">users</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                  id                  |      email       </span><br><span class=\"line\"><span class=\"comment\">--------------------------------------+------------------</span></span><br><span class=\"line\"> ccfcddd2-bdc5-4cf4-9475-4171960e6262 | test@example.com</span><br><span class=\"line\"> 431308b4-8df8-44c9-bed4-7c44cf4e1ec1 | TEST@example.com</span><br><span class=\"line\">(2 rows)</span><br></pre></td></tr></table></figure>\n<p>一般情況下，我們會使用 <code>Lower</code> 和 <code>ToLower</code>  建立唯一索引和尋找數據。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> emailunique_idx <span class=\"keyword\">on</span> <span class=\"keyword\">users</span> (<span class=\"keyword\">LOWER</span>(email)); </span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"keyword\">users</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">LOWER</span>(email) = <span class=\"keyword\">LOWER</span>(?);</span><br></pre></td></tr></table></figure>\n<p>但這種做法，忘了加 <code>LOWER</code> 就會令程序產生 Bug.</p>\n<p>其實 PostgreSQL 供提不少額外的模塊，只是沒有預設啟用。這裹說的 <code>CITEXT</code> 就是其中一個。<code>CITEXT</code> 顧名思義就是 <code>case insensitive text</code>。</p>\n<p>首先在 PostgreSQL 啟用額外的<code>CITEXT</code>模組。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> EXTENSION <span class=\"keyword\">IF</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">EXISTS</span> citext;</span><br></pre></td></tr></table></figure>\n<p>之後清空之前加入的數據，並修改 <code>email</code> 欄位屬情為 <code>citext</code>.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">TRUNCATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> RESTART <span class=\"keyword\">IDENTITY</span> RESTRICT;</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">users</span> <span class=\"keyword\">ALTER</span> <span class=\"keyword\">COLUMN</span> email <span class=\"keyword\">TYPE</span> citext;</span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> emailunique_idx <span class=\"keyword\">on</span> <span class=\"keyword\">users</span> (email);</span><br></pre></td></tr></table></figure>\n<p>之後再一次插入用戶數據，就可以看到樣同 <code>email</code> 並不能成功加入，並抛出錯誤。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'test@example.com'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">users</span> (email) <span class=\"keyword\">VALUES</span> (<span class=\"string\">'TEST@example.com'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">ERROR:  duplicate key value violates unique constraint \"email_unique\"  </span><br><span class=\"line\">DETAIL:  Key (email)=(TEST@example.com) already exists.</span><br></pre></td></tr></table></figure>\n<p>這種做法的好處是，欄位中己配置好檢查，不需要在代碼中每一次手動加上檢查，在數據庫的欄位上作出最後一道防線。別一方面，其他開發人員看到表的 <code>DDL</code> 時就明白這個欄位是不區分大少寫。</p>\n<p>最後這個模組是從 <code>PostgreSQL 9.3</code> 開始提供。</p>\n<p>Ref: <a href=\"http://shuber.io/case-insensitive-unique-constraints-in-postgres/\" target=\"_blank\" rel=\"noopener\">http://shuber.io/case-insensitive-unique-constraints-in-postgres/</a></p>\n","text":"在PostgreSQL 上建立欄位約束，是很簡單的事情，<br><br><br><br>CREATE TABLE users (  <br>  id     uuid PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),<br>  em","link":"","raw":null,"photos":["/2018/10/15/在PostgresSQL啟用不區分大小寫欄位/photo_2018-10-05_23-48-11.jpg"],"source":"_posts/2018/10/15-在PostgresSQL啟用不區分大小寫欄位.md","categories":[{"name":"SQL","slug":"SQL","count":2,"path":"api/categories/SQL.json"}],"tags":[]},{"_id":"cjmq4sgcp0000txpfmcnsid2z","title":"升級到macOS Mojave","slug":"升級到macOS-Mojave","date":"2018-10-01T17:56:53.000Z","updated":"2018-10-01T10:07:37.100Z","comments":true,"permalink":"/2018/10/01/升級到macOS-Mojave/","path":"api/articles/升級到macOS-Mojave.json","excerpt":"","keywords":null,"content":"<p>今天把筆記本升級到 Mojave，有Dark theme 看起來舒服多了，雖然還有部分軟件不支持。</p>\n<p>這次升級需時有點久，升了近一小時。而且升級後把 CommandLineTool刪了，需要重新下載。</p>\n<p><code>sudo xcode-select --install</code></p>\n","text":"今天把筆記本升級到 Mojave，有Dark theme 看起來舒服多了，雖然還有部分軟件不支持。這次升級需時有點久，升了近一小時。而且升級後把 CommandLineTool刪了，需要重新下載。sudo xcode-select --install","link":"","raw":null,"photos":["/2018/10/01/升級到macOS-Mojave/nadeshiko-kagamihara-4k-9b-1280x720.jpg"],"source":"_posts/2018/10/01-升級到macOS-Mojave.md","categories":[{"name":"日記","slug":"日記","count":20,"path":"api/categories/日記.json"}],"tags":[]},{"_id":"cjmklhtpp0000tsqjzf8qt81h","title":"Casbin-訪問權限控制工具","slug":"casbin-訪問權限控制工具","date":"2018-09-26T20:51:25.000Z","updated":"2018-09-27T13:08:43.994Z","comments":true,"permalink":"/2018/09/26/casbin-訪問權限控制工具/","path":"api/articles/casbin-訪問權限控制工具.json","excerpt":"","keywords":null,"content":"<p>Casbin 本質是一個配對的權限的工具庫，主要是由 model 模型和 policy 政策組成，</p>\n<p>model example</p>\n<p>r 是接受傳入的參數並定義欄位，例子中接受三項參數</p>\n<p>p 是解析 Prolicy 內容並定義欄位</p>\n<p>m 是配對 Policy 方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br><span class=\"line\" data-line-number=\"8\"></span><br><span class=\"line\" data-line-number=\"9\"></span><br><span class=\"line\" data-line-number=\"10\"></span><br><span class=\"line\" data-line-number=\"11\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[request_definition]</span><br><span class=\"line\">r = sub, obj, act</span><br><span class=\"line\"></span><br><span class=\"line\">[policy_definition]</span><br><span class=\"line\">p = sub, obj, act</span><br><span class=\"line\"></span><br><span class=\"line\">[policy_effect]</span><br><span class=\"line\">e = some(where (p.eft == allow))</span><br><span class=\"line\"></span><br><span class=\"line\">[matchers]</span><br><span class=\"line\">m = (p.sub in r.sub || p.sub == &quot;*&quot;) &amp;&amp; keyMatch(r.obj, p.obj) &amp;&amp; (r.act == p.act || p.act == &quot;*&quot;)</span><br></pre></td></tr></table></figure>\n<p>policy example </p>\n<p>ps:雖然是csv格式 但需要在逗號後留空白，別外內容的空白是會保留，不要因為對齊而加padding</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\">p, *, /info, GET</span><br><span class=\"line\">p, user, /users, GET</span><br><span class=\"line\">p, user, /users, POST</span><br><span class=\"line\">p, setting, /settings, *</span><br></pre></td></tr></table></figure>\n","text":"Casbin 本質是一個配對的權限的工具庫，主要是由 model 模型和 policy 政策組成，model exampler 是接受傳入的參數並定義欄位，例子中接受三項參數p 是解析 Prolicy 內容並定義欄位m 是配對 Policy 方式<br><br><br><br><","link":"","raw":null,"photos":["/2018/09/26/casbin-訪問權限控制工具/anime-love-live-sunshine-a9-1280x720.jpg"],"source":"_posts/2018/09/26-casbin-訪問權限控制工具.md","categories":[{"name":"Golang","slug":"Golang","count":3,"path":"api/categories/Golang.json"}],"tags":[]},{"_id":"cjmg3xrq30000ttmo9c172s81","title":"刪了Xcode後不能使用make等指令","slug":"刪了xcode後不能使用make等指令","date":"2018-09-24T17:43:26.000Z","updated":"2018-09-27T13:08:43.994Z","comments":true,"permalink":"/2018/09/24/刪了xcode後不能使用make等指令/","path":"api/articles/刪了xcode後不能使用make等指令.json","excerpt":"","keywords":null,"content":"<p>如果出現以下內容</p>\n<blockquote>\n<p>xcrun: error: active developer path (“/Applications/Xcode.app/Contents/Developer”) does not exist</p>\n</blockquote>\n<p>輸入 <code>sudo xcode-select -s /Library/Developer/CommandLineTools</code> 改回使用 CommandLineTools 的路徑</p>\n","text":"如果出現以下內容xcrun: error: active developer path (“/Applications/Xcode.app/Contents/Developer”) does not exist輸入 sudo xcode-select -s /Library/De","link":"","raw":null,"photos":[],"source":"_posts/2018/09/24-刪了xcode後不能使用make等指令.md","categories":[{"name":"ops","slug":"ops","count":1,"path":"api/categories/ops.json"}],"tags":[]}]}