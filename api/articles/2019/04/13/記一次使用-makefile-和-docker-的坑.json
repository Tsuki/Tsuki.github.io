{"title":"記一次使用 Makefile 和 Docker 的坑","slug":"記一次使用-makefile-和-docker-的坑","date":"2019-04-13T20:00:07.000Z","updated":"2019-04-14T13:06:14.198Z","comments":true,"path":"api/articles/2019/04/13/記一次使用-makefile-和-docker-的坑.json","photos":[],"link":"","excerpt":"前言在使用 make 和 Docker 構建發佈影像時，重構了一下 Makefile 而引起不算是 Bug 的 bug.事原Makefile 指令如果在用同的文件夾突特時 會出現 make: 指令 is up to date. 這樣奇怪的信訊？（？別外加上在 Docker build 的時候 make 指令的 step 出現 up to date 以為是被 cached。最後在 COPY --from=build-dev 時找不到文件 出現 /var/lib/docker/overlay2/ 找不到文件 而不是在 docker 對應路徑。解決在 Makefile 裹給指令 加上 .PHONY 注解。1<br>2<br>3<br>A phony target is one that is not really the name of a file; rather it is just a name for a recipe to be executed when you make an explicit request. There are two reasons to use a phony target: to avoid a conflict with a file of the same name, and to improve performance.<br><br>If you write a rule whose recipe will not create the target file, the recipe will be executed every time the target comes up for remaking.<br>GNU默认makefile target是一个文件，因此他会先检测同级目录下是否已存在这个文件，如果存在，则会abort掉make 进程，但目标不是文件的话，则会出现up to date的情况，这种情况需要.PHONY来避免问题的出现，phony的意思是“赝品”，在这里可以形象的理解成“不是文件”。","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>在使用 make 和 Docker 構建發佈影像時，重構了一下 Makefile 而引起不算是 Bug 的 bug.</p><h3 id=\"事原\"><a href=\"#事原\" class=\"headerlink\" title=\"事原\"></a>事原</h3><p>Makefile 指令如果在用同的文件夾突特時 會出現 <code>make: 指令 is up to date.</code> 這樣奇怪的信訊？（？</p><p>別外加上在 Docker build 的時候 make 指令的 step 出現 up to date 以為是被 cached。</p><p>最後在 <code>COPY --from=build-dev</code> 時找不到文件 出現 <code>/var/lib/docker/overlay2/</code> 找不到文件 而不是在 docker 對應路徑。</p><h3 id=\"解決\"><a href=\"#解決\" class=\"headerlink\" title=\"解決\"></a>解決</h3><p>在 Makefile 裹給指令 加上 <code>.PHONY</code> 注解。</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A phony target is one that is not really the name of a file; rather it is just a name for a recipe to be executed when you make an explicit request. There are two reasons to use a phony target: to avoid a conflict with a file of the same name, and to improve performance.</span><br><span class=\"line\"></span><br><span class=\"line\">If you write a rule whose recipe will not create the target file, the recipe will be executed every time the target comes up for remaking.</span><br></pre></td></tr></table></figure><p>GNU默认makefile target是一个文件，因此他会先检测同级目录下是否已存在这个文件，如果存在，则会abort掉make 进程，但目标不是文件的话，则会出现up to date的情况，这种情况需要.PHONY来避免问题的出现，phony的意思是“赝品”，在这里可以形象的理解成“不是文件”。</p><p><a href=\"https://blog.csdn.net/LinuxTiger/article/details/7955060\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/LinuxTiger/article/details/7955060</a></p>","prev":{"title":"Tensorflow尋找Tensor節點","link":"/2019/06/26/Tensorflow尋找Tensor節點"},"next":{"title":"把OPENSSL 私鑰轉換成 RSA 私鈅","link":"/2019/04/04/把OPENSSL-私鑰轉換成-RSA-私鈅"},"categories":[{"name":"Docker","slug":"Docker","count":1,"path":"api/categories/Docker.json"},{"name":"Linux","slug":"Docker/Linux","count":1,"path":"api/categories/Docker/Linux.json"}],"tags":[]}