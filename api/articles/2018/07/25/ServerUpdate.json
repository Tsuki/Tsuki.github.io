{"title":"ServerUpdate","slug":"ServerUpdate","date":"2018-07-25T14:11:07.000Z","updated":"2018-07-25T11:03:21.723Z","comments":true,"path":"api/articles/2018/07/25/ServerUpdate.json","photos":["https://blog.sukitsuki.com/2018/07/25/ServerUpdate/cjk0s2e3n00058i5n2cg1ayq9.jpg"],"link":"","excerpt":"","content":"<h1 id=\"服務器更新\"><a href=\"#服務器更新\" class=\"headerlink\" title=\"服務器更新\"></a>服務器更新</h1><p>今天把Debian滾到 9.5 內核升到 4.9, 因為Linux 4.9內核內建了tcp_bbr 算法。</p>\n<p>這算法對高延遲，高掉包的網絡有較大的提升</p>\n<p>不過香港的掉包和延遲不算嚴重，更新後提升不大</p>\n<h2 id=\"配置kernal-參數\"><a href=\"#配置kernal-參數\" class=\"headerlink\" title=\"配置kernal 參數\"></a>配置kernal 參數</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim /etc/sysctl.conf</span><br><span class=\"line\"><span class=\"comment\"># 增加以下兩條配置</span></span><br><span class=\"line\"><span class=\"comment\"># net.core.default_qdisc=fq</span></span><br><span class=\"line\"><span class=\"comment\"># net.ipv4.tcp_congestion_control=bbr</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"刷新內核配置\"><a href=\"#刷新內核配置\" class=\"headerlink\" title=\"刷新內核配置\"></a>刷新內核配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sysctl -p</span><br></pre></td></tr></table></figure>\n<h2 id=\"重啟和測試配置\"><a href=\"#重啟和測試配置\" class=\"headerlink\" title=\"重啟和測試配置\"></a>重啟和測試配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ reboot</span><br><span class=\"line\">$ sysctl net.ipv4.tcp_available_congestion_control</span><br><span class=\"line\"><span class=\"comment\"># 顯示結果中有bbr</span></span><br><span class=\"line\"><span class=\"comment\"># net.ipv4.tcp_available_congestion_control = bbr cubic reno</span></span><br></pre></td></tr></table></figure>\n<p>測試用指令 <code>wget -qO- bench.sh | bash</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">----------------------------------------------------------------------</span><br><span class=\"line\">CPU model            : AMD Phenom(tm) II X6 1055T Processor</span><br><span class=\"line\">Number of cores      : 6</span><br><span class=\"line\">CPU frequency        : 2812.247 MHz</span><br><span class=\"line\">Total size of Disk   : 95.0 GB (38.0 GB Used)</span><br><span class=\"line\">Total amount of Mem  : 491 MB (84 MB Used)</span><br><span class=\"line\">Total amount of Swap : 4090 MB (0 MB Used)</span><br><span class=\"line\">System uptime        : 0 days, 0 hour 5 min</span><br><span class=\"line\">Load average         : 0.06, 0.08, 0.04</span><br><span class=\"line\">OS                   : Debian GNU/Linux 9</span><br><span class=\"line\">Arch                 : x86_64 (64 Bit)</span><br><span class=\"line\">Kernel               : 4.9.0-6-amd64</span><br><span class=\"line\">----------------------------------------------------------------------</span><br><span class=\"line\">I/O speed(1st run)   : 93.1 MB/s</span><br><span class=\"line\">I/O speed(2nd run)   : 93.5 MB/s</span><br><span class=\"line\">I/O speed(3rd run)   : 97.0 MB/s</span><br><span class=\"line\">Average I/O speed    : 94.5 MB/s</span><br><span class=\"line\">----------------------------------------------------------------------</span><br><span class=\"line\">Node Name                       IPv4 address            Download Speed</span><br><span class=\"line\">CacheFly                        204.93.150.152          5.14MB/s</span><br><span class=\"line\">Linode, Tokyo, JP               106.187.96.148          1.12MB/s</span><br><span class=\"line\">Linode, Singapore, SG           139.162.23.4            1.29MB/s</span><br><span class=\"line\">Linode, London, UK              176.58.107.39           578KB/s</span><br><span class=\"line\">Linode, Frankfurt, DE           139.162.130.8           546KB/s</span><br><span class=\"line\">Linode, Fremont, CA             50.116.14.9             634KB/s</span><br><span class=\"line\">Softlayer, Dallas, TX           173.192.68.18           1.70MB/s</span><br><span class=\"line\">Softlayer, Seattle, WA          67.228.112.250          2.06MB/s</span><br><span class=\"line\">Softlayer, Frankfurt, DE        159.122.69.4            237KB/s</span><br><span class=\"line\">Softlayer, Singapore, SG        119.81.28.170           1.45MB/s</span><br><span class=\"line\">Softlayer, HongKong, CN         119.81.130.170          8.97MB/s</span><br><span class=\"line\">----------------------------------------------------------------------</span><br><span class=\"line\">SpeedTest</span><br><span class=\"line\">Hosted by STC (Hong Kong) : 5.976 ms</span><br><span class=\"line\">Testing download </span><br><span class=\"line\">Download: 289.92 Mbit/s</span><br><span class=\"line\">Testing upload </span><br><span class=\"line\">Upload: 52.48 Mbit/s</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Mac 虛擬化","link":"/2018/08/01/Mac-Hypervisor"},"next":{"title":"Python爬蟲","link":"/2018/07/18/Python爬蟲"},"categories":[{"name":"Ops","slug":"Ops","count":6,"path":"api/categories/Ops.json"}],"tags":[]}