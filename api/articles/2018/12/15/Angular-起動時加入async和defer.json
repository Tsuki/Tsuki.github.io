{"title":"Angular-起動時加入Async和defer","slug":"Angular-起動時加入async和defer","date":"2018-12-15T13:40:11.000Z","updated":"2018-12-15T09:47:09.529Z","comments":true,"path":"api/articles/2018/12/15/Angular-起動時加入async和defer.json","photos":["/2018/12/15/Angular-起動時加入async和defer/cjp40c7j60006wo8hur6fyehw.720p.jpg"],"link":"","excerpt":"","covers":null,"content":"<p>首先，在 Angular 不 Eject 的情況下，使用其他的 Webpack plugin，這樣需要引入 ngx-build-plus。</p><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install ngx-build-plus</span><br></pre></td></tr></table></figure><p>之後在 angular.json 替換 angular-cli 本來的引導指令</p><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">  <span class=\"string\">\"architect\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">\"builder\"</span>: <span class=\"string\">\"ngx-build-plus:build\"</span>,</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"string\">\"serve\"</span>: &#123;</span><br><span class=\"line\">       <span class=\"string\">\"builder\"</span>: <span class=\"string\">\"ngx-build-plus:dev-server\"</span>,</span><br><span class=\"line\">       ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure><p>別外，在目錄下加入額外的 Webpack 配置文件 <code>webpack.extra.js</code></p><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> ScriptExtHtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'script-ext-html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> METADATA = &#123;</span><br><span class=\"line\">  baseUrl: <span class=\"string\">'/'</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      template: <span class=\"string\">'src/index.html'</span>,</span><br><span class=\"line\">      chunksSortMode: <span class=\"string\">'dependency'</span>,</span><br><span class=\"line\">      metadata: METADATA,</span><br><span class=\"line\">      inject: <span class=\"string\">'head'</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> ScriptExtHtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"keyword\">async</span>: <span class=\"string\">'polyfills'</span>,</span><br><span class=\"line\">      defaultAttribute: <span class=\"string\">'defer'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p>由於 Angular 的 <code>zone.js</code> 需要比其他的 js 先載入，所以 polyfills 使用 <code>async</code>，而其他使用 <code>defer</code></p><p>這樣配置就可以把 <code>polyfills.js</code> 以外的 script 都加上 <code>defer</code> 屬性。</p><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"string\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: <span class=\"string\">\"ng build --prod --extraWebpackConfig webpack.extra.js\"</span>,</span><br><span class=\"line\">\t...</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure><p>最後修改 <code>package.json</code> 的 <code>build</code></p>","prev":null,"next":{"title":"主題遷移到 Angular 進度","link":"/2018/12/10/主題遷移到-Angular-進度"},"categories":[],"tags":[]}