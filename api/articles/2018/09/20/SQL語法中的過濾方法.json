{"title":"SQL語法中的過濾方法","slug":"SQL語法中的過濾方法","date":"2018-09-20T20:17:49.000Z","updated":"2018-09-20T12:58:44.135Z","comments":true,"path":"api/articles/2018/09/20/SQL語法中的過濾方法.json","photos":["/2018/09/20/SQL語法中的過濾方法/121654695498494.jpg"],"link":"","excerpt":"在統計系統中，很常用到不同維度的分類和過澽，比如按類加總/平均等等IdGenderSalaryCountryPositionStatus1M1000ChinaSoftwareworking2F2000USASoftwareholiday3M5000UKHardwareholiday4F4000GermanyHardwareworking5M5000USAAdminholiday6F4000GermanyAdminholiday如果在上要一次過找出Admin和非Admin人員的平均Salary可以在 SQL中用 filter 或 casePostgreSQL<br><br><br>select avg(salary) filter (where position = 'admin')  as admin_avg_salary,<br>       avg(salary) filter (where position &lt;&gt; 'admin') as non_admin_avg_salary<br>from raw_data<br>MySQL<br><br><br><br><br><br><br>select avg(salary CASE<br>                    WHEN position = 'admin' THEN salary<br>                    ELSE 0 END) as admin_avg_salary,<br>       avg(salary CASE<br>                    WHEN position &lt;&gt; 'admin' THEN salary<br>                    ELSE 0 END) as non_admin_avg_salary<br>from raw_data<br>","content":"<p>在統計系統中，很常用到不同維度的分類和過澽，</p>\n<p>比如按類加總/平均等等</p>\n<table>\n<thead>\n<tr>\n<th>Id</th>\n<th>Gender</th>\n<th>Salary</th>\n<th>Country</th>\n<th>Position</th>\n<th>Status</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>M</td>\n<td>1000</td>\n<td>China</td>\n<td>Software</td>\n<td>working</td>\n</tr>\n<tr>\n<td>2</td>\n<td>F</td>\n<td>2000</td>\n<td>USA</td>\n<td>Software</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>3</td>\n<td>M</td>\n<td>5000</td>\n<td>UK</td>\n<td>Hardware</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>4</td>\n<td>F</td>\n<td>4000</td>\n<td>Germany</td>\n<td>Hardware</td>\n<td>working</td>\n</tr>\n<tr>\n<td>5</td>\n<td>M</td>\n<td>5000</td>\n<td>USA</td>\n<td>Admin</td>\n<td>holiday</td>\n</tr>\n<tr>\n<td>6</td>\n<td>F</td>\n<td>4000</td>\n<td>Germany</td>\n<td>Admin</td>\n<td>holiday</td>\n</tr>\n</tbody>\n</table>\n<p>如果在上要一次過找出Admin和非Admin人員的平均Salary可以在 SQL中用 filter 或 case</p>\n<p>PostgreSQL</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(salary) filter (<span class=\"keyword\">where</span> <span class=\"keyword\">position</span> = <span class=\"string\">'admin'</span>)  <span class=\"keyword\">as</span> admin_avg_salary,</span><br><span class=\"line\">       <span class=\"keyword\">avg</span>(salary) filter (<span class=\"keyword\">where</span> <span class=\"keyword\">position</span> &lt;&gt; <span class=\"string\">'admin'</span>) <span class=\"keyword\">as</span> non_admin_avg_salary</span><br><span class=\"line\"><span class=\"keyword\">from</span> raw_data</span><br></pre></td></tr></table></figure>\n<p>MySQL</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\" data-line-number=\"1\"></span><br><span class=\"line\" data-line-number=\"2\"></span><br><span class=\"line\" data-line-number=\"3\"></span><br><span class=\"line\" data-line-number=\"4\"></span><br><span class=\"line\" data-line-number=\"5\"></span><br><span class=\"line\" data-line-number=\"6\"></span><br><span class=\"line\" data-line-number=\"7\"></span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">avg</span>(salary <span class=\"keyword\">CASE</span></span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> <span class=\"keyword\">position</span> = <span class=\"string\">'admin'</span> <span class=\"keyword\">THEN</span> salary</span><br><span class=\"line\">                    <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> <span class=\"keyword\">END</span>) <span class=\"keyword\">as</span> admin_avg_salary,</span><br><span class=\"line\">       <span class=\"keyword\">avg</span>(salary <span class=\"keyword\">CASE</span></span><br><span class=\"line\">                    <span class=\"keyword\">WHEN</span> <span class=\"keyword\">position</span> &lt;&gt; <span class=\"string\">'admin'</span> <span class=\"keyword\">THEN</span> salary</span><br><span class=\"line\">                    <span class=\"keyword\">ELSE</span> <span class=\"number\">0</span> <span class=\"keyword\">END</span>) <span class=\"keyword\">as</span> non_admin_avg_salary</span><br><span class=\"line\"><span class=\"keyword\">from</span> raw_data</span><br></pre></td></tr></table></figure>\n","prev":{"title":"前端好用的模糊搜索工具","link":"/2018/09/21/前端好用的模糊搜索工具"},"next":{"title":"gorm兼容net.IP類","link":"/2018/08/29/gorm兼容net-IP類"},"categories":[{"name":"SQL","slug":"SQL","count":2,"path":"api/categories/SQL.json"}],"tags":[]}